<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>NVIDIA Tegra Linux Driver Package Development Guide</title><link rel="Prev" href="l4t_lauterbach_scripts_r23.html" title="Previous"><link rel="Next" href="l4t_asoc_driver.html" title="Next"><link rel="StyleSheet" href="css/l4t_video_for_linux.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/l4t_video_for_linux_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN5_002bPjUpq_002fjj3JmExiOkShFA" class="ww_skin_page_body" style="background-attachment: scroll; background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html');"><header><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0"></td><td class="Header_Right">
           Tegra Linux Driver Package<br>
           Development Guide <br><font size="-1">May 16, 2016 | 24.1 Release</font></td></tr></table></div><!--     <br clear="all">
 --><hr color="#DEE4F0"><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E05J0HA" class="Heading_1">Video for Linux User Guide</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0ZJ0HA">V4L2/SOC_CAMERA Overview</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0VJ0HA">V4L2 on Jetson TX1</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0SH0HA">V4L2 Tegra Driver Overview</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0AE0HA">Writing and Integrating a Sensor Driver for L4T</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E2HA">Troubleshooting</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0EMHA">Resources</a></div></dd></dl></div><div id="wwpID0E04J0HA" class="Body_Text">This document provides information on use of the MIPI Camera Serial Interface (CSI) on NVIDIA<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;Tegra<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;X1, using software from the NVIDIA<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;Tegra<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;Linux Driver Package (also referred to as L4T). The MIPI CSI protocol, V4L2 API, Tegra&nbsp;X1 system architecture and method of attaching a CSI camera to Jetson&nbsp;TX1 are outside the scope of this document. </div><div id="wwpID0E03J0HA" class="Body_Text">The V4L2 software implementation bypasses the Tegra ISP, and is suitable for use when Tegra ISP support is not required, such as with sensors or input devices that provide data in YUV format.</div><div id="wwpID0E02J0HA" class="Body_Text">References to additional resources are provided, but the reader should already be familiar with Tegra&nbsp;X1, and have access to the <span class="Emphasis">Tegra Technical Reference Manual</span> (TRM) and other documentation available at the Jetson Embedded Platform portal:</div><div id="wwpID0E01J0HA" class="Body_Text"><span class="Hyperlink"><a href="http://developer.nvidia.com/embedded-computing" target="external_window">http://developer.nvidia.com/embedded-computing</a></span></div><div id="wwpID0E0ZJ0HA" class="Heading_2">V4L2/SOC_CAMERA Overview</div><div id="wwpID0E0YJ0HA" class="Body_Text">V4L2 is the second version of Video4Linux or V4L, a video capture and output device API and driver framework in the Linux kernel. It supports many USB webcams, TV tuners, and other devices and is closely integrated with the Linux kernel. For a description of the APIs, see <span class="Hyperlink"><a href="http://linuxtv.org/downloads/v4l-dvb-apis/" target="external_window">Linux Media Infrastructure APIs</a></span>.</div><div id="wwpID0E0XJ0HA" class="Body_Text"><span class="Code_Char">soc-camera</span> is a set of drivers and a core module, that implement V4L2 functionality on embedded devices; typically a video-enabled embedded device: SoC with a capture interface and video data sources. The <span class="Code_Char">soc-camera</span> includes host driver such as the Tegra V4L2 camera driver and client drivers (sensor drivers).</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 36pt; width: 391.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA0WJ0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 342pt"><div id="wwpID0EAAA0WJ0HA" class="Note_Text">Software releases after R23: <span class="Code_Char">soc_camera</span> driver is deprecated and replaced with the media-controller driver. The media-controller driver framework is V4L2-compatible and provides greater functionality than the <span class="Code_Char">soc_camera</span> driver. Existing V4L2 sensor drivers require minor modifications to be compatible with media-controller. Plan your software development for this transition.</div></td></tr></table></div><div id="wwpID0E0VJ0HA" class="Heading_2">V4L2 on Jetson TX1</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0QJ0HA">Test Pattern Generator</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0DJ0HA">Example Sensor: OV5693</a></div></dd></dl></div><div id="wwpID0E0UJ0HA" class="Body_Text">Jetson TX1 is a powerful embedded development board including the NVIDIA<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;Tegra<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;X1 processor. Tegra&nbsp;X1 processors have a video input interface (VI) and camera serial interface (CSI), so Tegra&nbsp;X1 can communicate with the external video input sources, such as camera sensor module or other MIPI CSI compatible devices. VI/CSI of Tegra&nbsp;X1 also has two test pattern generators that can generate some data patterns like color bricks for testing purpose. You can find out more about this development board at:</div><div id="wwpID0E0TJ0HA" class="Body_Text"><span class="Hyperlink"><a href="http://elinux.org/Jetson_TX1" target="external_window">http://elinux.org/Jetson_TX1</a></span> </div><div id="wwpID0E0SJ0HA" class="Body_Text">On the software side, Linux for Tegra (L4T) latest release R23 provides a Tegra V4L2 camera driver and sample drivers for a camera sensor and a built-in test pattern generator (TPG). With an open source V4L2 user space tool like Yavta, users can capture data from the TPG and sensors. For more information about Yavta, see:</div><div id="wwpID0E0RJ0HA" class="Body_Text"><span class="Hyperlink"><a href="http://git.ideasonboard.org/yavta.git" target="external_window">http://git.ideasonboard.org/yavta.git</a></span> </div><div id="wwpID0E0QJ0HA" class="Heading_3">Test Pattern Generator</div><div id="wwpID0E0PJ0HA" class="Body_Text">The test pattern generator is a configurable resource introduced to improve hardware verification capability for the Tegra CSI. There are two separate test pattern generators that can be configured to provide for the generation of synthetic image data, which is delivered to the PPA and PPB input FIFOs. The image data is multiplexed into the CSI data patch between lane-merging logic and the data FIFOs.</div><div id="wwpID0E0OJ0HA" class="Body_Text">L4T provides a virtual V4L2 <span class="Code_Char">soc_camera</span> sensor driver for exposing TPG functionality (<span class="Code_Char">soc_camera_platform driver</span>). It can generate 1280x720 resolution RGBA32 color bricks data. There is no need to rebuild the kernel and the <span class="Code_Char">soc_camera_platform driver</span> is provided as a loadable module.</div><div id="wwpID0E0NJ0HA" class="Heading_5">To verify the TPG</div><div id="wwpID0E0MJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Remove the <span class="Code_Char">nvhost_vi</span> module, an incompatible non-V4L2 VI driver used for other purposes and outside the scope of this document:</div><div id="wwpID0E0LJ0HA" class="Code">$ sudo rmmod nvhost_vi</div><div id="wwpID0E0KJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Install V4L2 driver modules:</div><div id="wwpID0E0JJ0HA" class="Code">$ sudo modprobe soc_camera_platform</div><div id="wwpID0E0IJ0HA" class="Code">$ sudo modprobe tegra_camera tpg_mode=2</div><div id="wwpID0E0HJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Use the yavta application to capture data (other V4L2 applications can be used, if preferred)</div><div id="wwpID0E0GJ0HA" class="Code">$ ./yavta /dev/video0 -c1 -n1 -s1280x720 -fRGB32 -Ftpg.rgba</div><div id="wwpID0E0FJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Copy over <span class="Code_Char">tpg.rgba</span> to host and use ImageMagick to show the picture:</div><div id="wwpID0E0EJ0HA" class="Code">$ display -size 1280x720 -depth 8 tpg.rgba</div><div id="wwpID0E0DJ0HA" class="Heading_3">Example Sensor: OV5693</div><div id="wwpID0E0CJ0HA" class="Body_Text">L4T provides a sample V4L2 sensor driver for the OmniVision OV5693 Bayer sensor. This driver can be used as a reference in creating a custom V4L2 sensor driver. NVIDIA provides a reference OV5693 camera module E3326, with Jetson&nbsp;TX1.</div><div id="wwpID0E0BJ0HA" class="Body_Text">The driver for OV5693 is neither built into the kernel nor built as module. Please try the following steps to test OV5693 in L4T on Jetson&nbsp;TX1.</div><div id="wwpID0E0AJ0HA" class="Body_Text">Hardware setup:</div><div id="wwpID0E06I0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Jetson&nbsp;TX1</div><div id="wwpID0E05I0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>OV5693 camera module</div><div id="wwpID0E04I0HA" class="Heading_5">To test OV5693 in L4T on Jetson TX1</div><div id="wwpID0E03I0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Apply patches on top of L4T release.</div><div id="wwpID0E02I0HA" class="List_Continue">L4T 23.1 Release (19 patches)</div><div id="wwpID0E01I0HA" class="Code">$ tar xfz r23.1_v4l2.tgz</div><div id="wwpID0E0ZI0HA" class="Code">&nbsp;</div><div id="wwpID0E0YI0HA" class="Code">$ ls r23.1/</div><div id="wwpID0E0XI0HA" class="Code">0001-drivers-soc_camera-add-ov23850-OTP-controls.patch</div><div id="wwpID0E0WI0HA" class="Code">0002-drivers-soc_camera-sensor-drivers-update.patch</div><div id="wwpID0E0VI0HA" class="Code">0003-drivers-media-platform-tegra-get-gpio-pwr-info.patch</div><div id="wwpID0E0UI0HA" class="Code">0004-drivers-media-soc_camera-IMX230-driver-to-gain.patch</div><div id="wwpID0E0TI0HA" class="Code">0005-drivers-Restructure-GRHOST_VI.patch</div><div id="wwpID0E0SI0HA" class="Code">0006-media-v4l2-core-Migration-from-upstream.patch</div><div id="wwpID0E0RI0HA" class="Code">0007-media-soc_camera-add-ov13860-v4l2-driver.patch</div><div id="wwpID0E0QI0HA" class="Code">0008-drivers-media-platform-ov5693-gpio-warning.patch</div><div id="wwpID0E0PI0HA" class="Code">0009-media-tegra_camera-support-YUV-CSI-input.patch</div><div id="wwpID0E0OI0HA" class="Code">0010-kernel-changes-for-implementing-sensor-cropping.patch</div><div id="wwpID0E0NI0HA" class="Code">0011-drivers-soc_camera-give-default-hdr_en.patch</div><div id="wwpID0E0MI0HA" class="Code">0012-media-tegra_camera-fix-syncpoint-time-out-issue.patch</div><div id="wwpID0E0LI0HA" class="Code">0013-media-soc-camera-actually-use-default-resolution.patch</div><div id="wwpID0E0KI0HA" class="Code">0014-media-soc_camera-add-tc358840-v4l2-driver.patch</div><div id="wwpID0E0JI0HA" class="Code">0015-media-soc_camera-vi2-support-gang-mode.patch</div><div id="wwpID0E0II0HA" class="Code">0016-media-camera-common-export-symbols-for-modules.patch</div><div id="wwpID0E0HI0HA" class="Code">0017-media-tegra_camera-init-mipi-bias-pad.patch</div><div id="wwpID0E0GI0HA" class="Code">0018-ARM64-t210-add-E3326-camera-and-camera_common.patch</div><div id="wwpID0E0FI0HA" class="Code">0019-ARM64-adding-OV5693-V4L2-on-E3326-jetson_cv.patch</div><div id="wwpID0E0EI0HA" class="Code">&nbsp;</div><div id="wwpID0E0DI0HA" class="Code">$ git am r23.1/*</div><div id="wwpID0E0CI0HA" class="List_Continue">L4T R23.2 Release (1 patch)</div><div id="wwpID0E0BI0HA" class="Code">$ git am 0001-ARM64-adding-OV5693-V4L2-on-E3326-jetson_cv.patch</div><div id="wwpID0E0AI0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Enable OV5693 kernel driver and disable <span class="Code_Char">soc_camera_platform.</span></div><div id="wwpID0E06H0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>CONFIG_SOC_CAMERA_OV5693=m</div><div id="wwpID0E05H0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>CONFIG_VIDEO_TEGRA_VI=m</div><div id="wwpID0E04H0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Disable CONFIG_SOC_CAMERA_PLATFORM</div><div id="wwpID0E03H0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Disable CONFIG_SOC_CAMERA_OV13860</div><div id="wwpID0E02H0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Disable CONFIG_SOC_CAMERA TC358840</div><div id="wwpID0E01H0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Build kernel, flash Jetson&nbsp;TX1 and boot the Linux OS.</div><div id="wwpID0E0ZH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Use Yavta to capture a frame.</div><div id="wwpID0E0YH0HA" class="Code">$ sudo rmmod nvhost-vi</div><div id="wwpID0E0XH0HA" class="Code">$ sudo modprobe ov5693_v4l2</div><div id="wwpID0E0WH0HA" class="Code">$ sudo modprobe tegra_camera</div><div id="wwpID0E0VH0HA" class="Code">$ ./yavta /dev/video0 -c1 -n1 -s1920x1080 -fSRGGB10 -Fov.raw</div><div id="wwpID0E0UH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Use <span class="Code_Char">raw2bmp</span> to convert raw data to BMP file.</div><div id="wwpID0E0TH0HA" class="Code">$ ./raw2bmp ov.raw ov.bmp 1920 1080 16 3</div><div id="wwpID0E0SH0HA" class="Heading_2">V4L2 Tegra Driver Overview</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0PH0HA">Tegra V4L2 Camera Driver </a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E03G0HA">Tegra V4L2 Sensor Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0JG0HA">Board File </a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0EE0HA">Device Tree File</a></div></dd></dl></div><div id="wwpID0E0RH0HA" class="Body_Text">As V4L2 is a kernel video input framework, Tegra V4L2 stack contains several components. It controls hardware such as the Tegra VI/CSI hardware controller and external sensors. Additionally, it exports a generic device node named <span class="Code_Char">/dev/video&lt;N&gt;</span> to user space, where <span class="Code_Char">&lt;N&gt;</span> is a numeric value. User space applications can use V4L2 standard API to control real hardware via <span class="Code_Char">/dev/video&lt;N&gt;</span>.</div><div id="wwpID0E0QH0HA" class="Body_Text">This section focuses on Tegra&nbsp;X1-related drivers and code in L4T kernel source.</div><div id="wwpID0E0PH0HA" class="Heading_3">Tegra V4L2 Camera Driver </div><div id="wwpID0E0OH0HA" class="Body_Text">Tegra V4L2 camera driver is a part of soc_camera and acts as a host driver. It directly controls Tegra&nbsp;X1 VI/CSI hardware. Normally users don’t need to modify this driver, but developers should become familiar with it; it may require customization for some use cases.</div><div id="wwpID0E0NH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Source code</div><div id="wwpID0E0MH0HA" class="Code">drivers/media/platform/soc_camera/Kconfig</div><div id="wwpID0E0LH0HA" class="Code">drivers/media/platform/soc_camera/Makefile</div><div id="wwpID0E0KH0HA" class="Code">drivers/media/platform/soc_camera/tegra_camera/*</div><div id="wwpID0E0JH0HA" class="Code">include/media/tegra_v4l2_camera.h</div><div id="wwpID0E0IH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Kernel config</div><div id="wwpID0E0HH0HA" class="Code">CONFIG_VIDEO_TEGRA=m</div><div id="wwpID0E0GH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span><span class="Code_Char">tegra_camera.ko</span> module</div><div id="wwpID0E0FH0HA" class="List_Continue">The module name is <span class="Code_Char">tegra_camera.ko</span> and it won’t be loaded by default after booting into L4T. There is another driver named <span class="Code_Char">nvhost_vi.ko</span> installed by default and is mutually-exclusive with <span class="Code_Char">tegra_camera.ko</span>, so users must remove the <span class="Code_Char">nvhost_vi.ko</span> before loading <span class="Code_Char">tegra_camera.ko</span>.</div><div id="wwpID0E0EH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Input data format</div><div id="wwpID0E0DH0HA" class="List_Continue">Tegra&nbsp;X1 VI/CSI hardware supports 3 major input data formats: YUV, RGB, and Bayer RAW. However in this driver only the following have been tested:</div><div id="wwpID0E0CH0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>RGB888</div><div id="wwpID0E0BH0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>RAW8</div><div id="wwpID0E0AH0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>RAW10</div><div id="wwpID0E06G0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>YUV422</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 54pt; width: 374.4pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA05G0HA" class="Note_Image" style="text-align: left">Note:</div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 324.9pt"><div id="wwpID0EAAA05G0HA" class="Note_Text">Some other formats are also supported by hardware, but software support is not present in the driver. Please refer to the Tegra TRM for details on supported input formats.</div></td></tr></table></div><div id="wwpID0E04G0HA" class="Body_Text">Please study the source code then add new input data formats not listed here.</div><div id="wwpID0E03G0HA" class="Heading_3">Tegra V4L2 Sensor Driver</div><div id="wwpID0E02G0HA" class="Body_Text">V4L2 sensor driver normally is an I2C device driver and in L4T it is also a V4L2 <span class="Code_Char">soc_camera</span> client driver. It has several I2C register tables for different resolutions like 1920x1080, 1280x720, etc. When a user space application opens <span class="Code_Char">/dev/video&lt;N&gt;</span>, the sensor driver powers on the sensor hardware and programs it with the register table via I2C.</div><div id="wwpID0E01G0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Real sensor code</div><div id="wwpID0E0ZG0HA" class="Code">drivers/media/i2c/soc_camera/ov5693_v4l2.c</div><div id="wwpID0E0YG0HA" class="Code">drivers/media/i2c/soc_camera/ov5693_mode_tbls.h</div><div id="wwpID0E0XG0HA" class="Code">include/media/ov5693.h</div><div id="wwpID0E0WG0HA" class="Code">drivers/media/i2c/soc_camera/Kconfig</div><div id="wwpID0E0VG0HA" class="Code">drivers/media/i2c/soc_camera/Makefile</div><div id="wwpID0E0UG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Test Pattern Generator virtual sensor driver source code</div><div id="wwpID0E0TG0HA" class="Code">drivers/media/platform/soc_camera/soc_camera_platform.c</div><div id="wwpID0E0SG0HA" class="List_Continue">The <span class="Code_Char">soc_camera_platform</span> driver does not perform any real hardware operations like power control and I2C transactions. It is just a virtual driver to enable use of the TPG for testing.</div><div id="wwpID0E0RG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Kernel configs</div><div id="wwpID0E0QG0HA" class="Code">CONFIG_SOC_CAMERA_OV5693</div><div id="wwpID0E0PG0HA" class="Code">CONFIG_SOC_CAMERA_PLATFORM</div><div id="wwpID0E0OG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Power controls</div><div id="wwpID0E0NG0HA" class="List_Continue">Each sensor has its own power on/off sequence, clock settings and other hardware specific operations. L4T sensor driver puts these power controls in the sensor driver itself. For more flexible driver design, these power controls must go to board files since each hardware board may have different power controls. Then, the sensor driver itself can be more generic. Normally, power controls include:</div><div id="wwpID0E0MG0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>GPIO for sensor reset, power on or power down</div><div id="wwpID0E0LG0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Regulators for sensor power supply</div><div id="wwpID0E0KG0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Clocks for sensor running like mclk or sensor local clock</div><div id="wwpID0E0JG0HA" class="Heading_3">Board File </div><div id="wwpID0E0IG0HA" class="Body_Text">Before fully moving to device tree binding, a board file is the only way to describe platform-specific configurations within the Linux kernel. Beginning in L4T R23 releases, most hardware devices use device tree binding, but V4L2 <span class="Code_Char">soc_camera</span> still uses a board file approach.</div><div id="wwpID0E0HG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Source code</div><div id="wwpID0E0GG0HA" class="Code">arch/arm64/mach-tegra/board-t210ref-camera.c</div><div id="wwpID0E0FG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>TPG board configs</div><div id="wwpID0E0EG0HA" class="List_Continue"><span class="Code_Char">soc_camera_platform_info</span> defines data format and resolution which must be matched with our TPG hardware.</div><div id="wwpID0E0DG0HA" class="Code">static struct soc_camera_platform_info t210ref_soc_camera_info = {</div><div id="wwpID0E0CG0HA" class="Code">        .format_name = "RGB4",</div><div id="wwpID0E0BG0HA" class="Code">        .format_depth = 32,</div><div id="wwpID0E0AG0HA" class="Code">        .format = {</div><div id="wwpID0E06F0HA" class="Code">                .code = V4L2_MBUS_FMT_RGBA8888_4X8_LE,</div><div id="wwpID0E05F0HA" class="Code">                .colorspace = V4L2_COLORSPACE_SRGB,</div><div id="wwpID0E04F0HA" class="Code">                .field = V4L2_FIELD_NONE,</div><div id="wwpID0E03F0HA" class="Code">                .width = 1280,</div><div id="wwpID0E02F0HA" class="Code">                .height = 720,</div><div id="wwpID0E01F0HA" class="Code">        },</div><div id="wwpID0E0ZF0HA" class="Code">        .set_capture = t210ref_soc_camera_set_capture,</div><div id="wwpID0E0YF0HA" class="Code">};</div><div id="wwpID0E0XF0HA" class="List_Continue"><span class="Code_Char">tegra_camera_platform_data</span> is the most important data structure to describe the sensor connection. <span class="Code_Char">.port</span> indicates which CSI port the sensor connects to: </div><div id="wwpID0E0WF0HA" class="List_Continue">TEGRA_CAMERA_PORT_CSI_A means the sensor uses CIL_A. </div><div id="wwpID0E0VF0HA" class="List_Continue">TEGRA_CAMERA_PORT_CSI_B means the sensor uses CIL_B.</div><div id="wwpID0E0UF0HA" class="List_Continue">TEGRA_CAMERA_PORT_CSI_C means the sensor uses CIL_C.</div><div id="wwpID0E0TF0HA" class="List_Continue">TEGRA_CAMERA_PORT_CSI_D means the sensor uses CIL_D. </div><div id="wwpID0E0SF0HA" class="List_Continue">TEGRA_CAMERA_PORT_CSI_E means the sensor uses CIL_E.</div><div id="wwpID0E0RF0HA" class="List_Continue">TEGRA_CAMERA_PORT_CSI_F means the sensor uses CIL_F.</div><div id="wwpID0E0QF0HA" class="List_Continue">Tegra&nbsp;X1 internally has 6 CSI channels (CSI_A to CSI_F). CSI A/C/E channel can support 1, 2 and 4 data lane sensors and CSI B/D/F can support 1 and 2 data lane sensors..</div><div id="wwpID0E0PF0HA" class="Code">static struct tegra_camera_platform_data t210ref_camera_platform_data = {</div><div id="wwpID0E0OF0HA" class="Code">        .flip_v                 = 0,</div><div id="wwpID0E0NF0HA" class="Code">        .flip_h                 = 0,</div><div id="wwpID0E0MF0HA" class="Code">        .port                   = TEGRA_CAMERA_PORT_CSI_A,</div><div id="wwpID0E0LF0HA" class="Code">        .lanes                  = 4,</div><div id="wwpID0E0KF0HA" class="Code">        .continuous_clk         = 0,</div><div id="wwpID0E0JF0HA" class="Code">};</div><div id="wwpID0E0IF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>OV5693 board file configs</div><div id="wwpID0E0HF0HA" class="List_Continue">Real sensors do not require that sensor resolution or data format information be put into the board file like TPG <span class="Code_Char">soc_camera_platform</span> driver, because that information is in the sensor driver itself.</div><div id="wwpID0E0GF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>OV5693 connects to port CSI_C via 2 data lanes:</div><div id="wwpID0E0FF0HA" class="Code_Indent">static struct tegra_camera_platform_data</div><div id="wwpID0E0EF0HA" class="Code_Indent">t210ref_ov5693_e3326_camera_platform_data = {</div><div id="wwpID0E0DF0HA" class="Code_Indent">        .flip_v                 = 0,</div><div id="wwpID0E0CF0HA" class="Code_Indent">        .flip_h                 = 0,</div><div id="wwpID0E0BF0HA" class="Code_Indent">        .port                   = TEGRA_CAMERA_PORT_CSI_C,</div><div id="wwpID0E0AF0HA" class="Code_Indent">        .lanes                  = 2,</div><div id="wwpID0E06E0HA" class="Code_Indent">        .continuous_clk         = 0,</div><div id="wwpID0E05E0HA" class="Code_Indent">};</div><div id="wwpID0E04E0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>OV5693 uses I2C bus 6 and it’s I2C address is 0x36:</div><div id="wwpID0E03E0HA" class="Code_Indent">static struct camera_common_pdata t210ref_ov5693_e3326_data = {</div><div id="wwpID0E02E0HA" class="Code_Indent">        .regulators = {</div><div id="wwpID0E01E0HA" class="Code_Indent">                .avdd = "vana",</div><div id="wwpID0E0ZE0HA" class="Code_Indent">                .iovdd = "vif",</div><div id="wwpID0E0YE0HA" class="Code_Indent">        },</div><div id="wwpID0E0XE0HA" class="Code_Indent">        .reset_gpio = 148, /* TEGRA_GPIO_PS4 */</div><div id="wwpID0E0WE0HA" class="Code_Indent">        .pwdn_gpio = 151, /* TEGRA_GPIO_PS7 */</div><div id="wwpID0E0VE0HA" class="Code_Indent">};</div><div id="wwpID0E0UE0HA" class="Code_Indent">&nbsp;</div><div id="wwpID0E0TE0HA" class="Code_Indent">static struct i2c_board_info t210ref_ov5693_e3326_camera_i2c_device = {</div><div id="wwpID0E0SE0HA" class="Code_Indent">        I2C_BOARD_INFO("ov5693_v4l2", 0x36),</div><div id="wwpID0E0RE0HA" class="Code_Indent">};</div><div id="wwpID0E0QE0HA" class="Code_Indent">&nbsp;</div><div id="wwpID0E0PE0HA" class="Code_Indent">static struct soc_camera_link ov5693_e3326_iclink = {</div><div id="wwpID0E0OE0HA" class="Code_Indent">        .bus_id         = 0, /* This must match the .id of tegra_vi01_device */</div><div id="wwpID0E0NE0HA" class="Code_Indent">        .board_info     = &amp;t210ref_ov5693_e3326_camera_i2c_device,</div><div id="wwpID0E0ME0HA" class="Code_Indent">        .module_name    = "ov5693_v4l2",</div><div id="wwpID0E0LE0HA" class="Code_Indent">        .i2c_adapter_id = 6, /* VI2 I2C controller */</div><div id="wwpID0E0KE0HA" class="Code_Indent">        .power          = t210ref_ov5693_power,</div><div id="wwpID0E0JE0HA" class="Code_Indent">        .priv           = &amp;t210ref_ov5693_e3326_camera_platform_data,</div><div id="wwpID0E0IE0HA" class="Code_Indent">        .dev_priv       = &amp;t210ref_ov5693_e3326_data,</div><div id="wwpID0E0HE0HA" class="Code_Indent">};</div><div id="wwpID0E0GE0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Register OV5693 soc_camera platform device:</div><div id="wwpID0E0FE0HA" class="Code_Indent">platform_device_register(&amp;t210ref_ov5693_e3326_soc_camera_device);</div><div id="wwpID0E0EE0HA" class="Heading_3">Device Tree File</div><div id="wwpID0E0DE0HA" class="Body_Text">Device tree provides regulator information required by the V4L2 sensor driver. OV5693 sensor driver use 2 regulators: <span class="Code_Char">vana</span> and <span class="Code_Char">vif</span>. They are defined in:</div><div id="wwpID0E0CE0HA" class="Code">arch/arm64/boot/dts/tegra210-platforms/tegra210-jetson-e-pmic-p2530-0930-e03.dtsi</div><div id="wwpID0E0BE0HA" class="Code">arch/arm64/boot/dts/tegra210-platforms/tegra210-jetson-e-power-fixed-p2530-0930-e03.dtsi</div><div id="wwpID0E0AE0HA" class="Heading_2">Writing and Integrating a Sensor Driver for L4T</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E05D0HA">Sensor Driver Development</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_video_for_linux.html#wwpID0E0NC0HA">Board File and Device Tree File Updates</a></div></dd></dl></div><div id="wwpID0E06D0HA" class="Body_Text">Developers can write their own sensor driver for their specific device. Sensor drivers usually have very similar structures but different I2C register tables. Modification of the board file and the device tree file is required for different boards.</div><div id="wwpID0E05D0HA" class="Heading_3">Sensor Driver Development</div><div id="wwpID0E04D0HA" class="Body_Text">The OV5693 sensor drivers are a good starting point for writing a new sensor driver. The following steps are recommended for developing a new driver:</div><div id="wwpID0E03D0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Import new I2C register tables</div><div id="wwpID0E02D0HA" class="List_Continue">Sensor vendors provide I2C register settings as tables, which must be added to sensor driver. The following struct is a good example:</div><div id="wwpID0E01D0HA" class="Code">static const ov5693_reg *mode_table[] = {</div><div id="wwpID0E0ZD0HA" class="Code">        [OV5693_MODE_2592X1944]                 = mode_2592x1944,</div><div id="wwpID0E0YD0HA" class="Code">        [OV5693_MODE_2592X1458]                 = mode_2592x1458,</div><div id="wwpID0E0XD0HA" class="Code">        [OV5693_MODE_1920X1080]                 = mode_1920x1080,</div><div id="wwpID0E0WD0HA" class="Code">        [OV5693_MODE_1296X972]                  = mode_1296x972,</div><div id="wwpID0E0VD0HA" class="Code">        [OV5693_MODE_1280X720_120FPS]           = mode_1280x720_120fps,</div><div id="wwpID0E0UD0HA" class="Code">        [OV5693_MODE_2592X1944_HDR]             = mode_2592x1944_HDR_24fps,</div><div id="wwpID0E0TD0HA" class="Code">        [OV5693_MODE_1920X1080_HDR]             = mode_1920x1080_HDR_30fps,</div><div id="wwpID0E0SD0HA" class="Code">        [OV5693_MODE_1296X972_HDR]              = mode_1296x972_HDR_30fps,</div><div id="wwpID0E0RD0HA" class="Code">&nbsp;</div><div id="wwpID0E0QD0HA" class="Code">        [OV5693_MODE_START_STREAM]              = ov5693_start,</div><div id="wwpID0E0PD0HA" class="Code">        [OV5693_MODE_STOP_STREAM]               = ov5693_stop,</div><div id="wwpID0E0OD0HA" class="Code">        [OV5693_MODE_TEST_PATTERN]              = tp_colorbars,</div><div id="wwpID0E0ND0HA" class="Code">};</div><div id="wwpID0E0MD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Power controls</div><div id="wwpID0E0LD0HA" class="List_Continue">Different boards have different sensor power controls. It is better put those power controls into a board file. But it is simpler to implement them in a sensor driver. Please take a look at <span class="Code_Char">OV5693_power_on()</span> and <span class="Code_Char">OV5693_power_off()</span> functions.</div><div id="wwpID0E0KD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span><span class="Code_Char">soc_camera</span> and I2C interface</div><div id="wwpID0E0JD0HA" class="List_Continue">The sensor driver implements <span class="Code_Char">soc_camera_ops</span> functions as well as I2C device probing/removing functions. Normally these are quite similar across different sensor drivers—just reuse them in your driver and use <span class="Code_Char">OV5693_v4l2.c</span> as an example.</div><div id="wwpID0E0ID0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>KConfig and Makefile</div><div id="wwpID0E0HD0HA" class="List_Continue">Add a <span class="Code_Char">SOC_CAMERA_OV5693</span> entry into the <span class="Code_Char">Kconfig</span> and <span class="Code_Char">Makefile</span> files.</div><div id="wwpID0E0GD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Header file <span class="Code_Char">include/media/ov5693.h</span></div><div id="wwpID0E0FD0HA" class="List_Continue">This header contains some information for non-V4L2 NVIDIA camera stacks. The following structures can be reused if necessary:</div><div id="wwpID0E0ED0HA" class="Code">struct ov5693_regulators {</div><div id="wwpID0E0DD0HA" class="Code">        const char *avdd;</div><div id="wwpID0E0CD0HA" class="Code">        const char *dvdd;</div><div id="wwpID0E0BD0HA" class="Code">        const char *dovdd;</div><div id="wwpID0E0AD0HA" class="Code">};</div><div id="wwpID0E06C0HA" class="Code">&nbsp;</div><div id="wwpID0E05C0HA" class="Code">struct ov5693_platform_data {</div><div id="wwpID0E04C0HA" class="Code">        unsigned cfg;</div><div id="wwpID0E03C0HA" class="Code">        unsigned num;</div><div id="wwpID0E02C0HA" class="Code">        const char *dev_name;</div><div id="wwpID0E01C0HA" class="Code">        unsigned gpio_count; /* see nvc.h GPIO notes */</div><div id="wwpID0E0ZC0HA" class="Code">        struct nvc_gpio_pdata *gpio; /* see nvc.h GPIO notes */</div><div id="wwpID0E0YC0HA" class="Code">        struct nvc_imager_static_nvc *static_info;</div><div id="wwpID0E0XC0HA" class="Code">        bool use_vcm_vdd;</div><div id="wwpID0E0WC0HA" class="Code">        int (*probe_clock)(unsigned long);</div><div id="wwpID0E0VC0HA" class="Code">        int (*power_on)(struct ov5693_power_rail *);</div><div id="wwpID0E0UC0HA" class="Code">        int (*power_off)(struct ov5693_power_rail *);</div><div id="wwpID0E0TC0HA" class="Code">        const char *mclk_name;</div><div id="wwpID0E0SC0HA" class="Code">        struct nvc_imager_cap *cap;</div><div id="wwpID0E0RC0HA" class="Code">        struct ov5693_regulators regulators;</div><div id="wwpID0E0QC0HA" class="Code">        bool has_eeprom;</div><div id="wwpID0E0PC0HA" class="Code">        bool use_cam_gpio;</div><div id="wwpID0E0OC0HA" class="Code">};</div><div id="wwpID0E0NC0HA" class="Heading_3">Board File and Device Tree File Updates</div><div id="wwpID0E0MC0HA" class="Body_Text">A new project or new hardware board may have a new board file such as board-<span class="Code_Char">t210ref*.c</span> for Jetson&nbsp;TX1. If so, the new board file must include those settings for sensor drivers. Follow this template in the board file and replace <span class="Code_Char">SENSOR</span> with your sensor name:</div><div id="wwpID0E0LC0HA" class="Code">#if IS_ENABLED(CONFIG_SOC_CAMERA_SENSOR)</div><div id="wwpID0E0KC0HA" class="Code">static int t210ref_sensor_power(struct device *dev, int enable)</div><div id="wwpID0E0JC0HA" class="Code">{</div><div id="wwpID0E0IC0HA" class="Code">        return 0;</div><div id="wwpID0E0HC0HA" class="Code">}</div><div id="wwpID0E0GC0HA" class="Code">// NOTE: power controls can go here instead of sensor driver itself.</div><div id="wwpID0E0FC0HA" class="Code">&nbsp;</div><div id="wwpID0E0EC0HA" class="Code">struct sensor_platform_data t210ref_sensor_data;</div><div id="wwpID0E0DC0HA" class="Code">&nbsp;</div><div id="wwpID0E0CC0HA" class="Code">static struct i2c_board_info t210_sensor_camera_i2c_device = {</div><div id="wwpID0E0BC0HA" class="Code">        I2C_BOARD_INFO("sensor_v4l2_driver_name", sensor_i2c_address),</div><div id="wwpID0E0AC0HA" class="Code">        // sensor_v4l2_driver_name should match the sensor driver’s module name</div><div id="wwpID0E06B0HA" class="Code">        .platform_data = &amp;t210ref_sensor_data,</div><div id="wwpID0E05B0HA" class="Code">};</div><div id="wwpID0E04B0HA" class="Code">&nbsp;</div><div id="wwpID0E03B0HA" class="Code">static struct tegra_camera_platform_data t210ref_sensor_camera_platform_data = {</div><div id="wwpID0E02B0HA" class="Code">        .flip_v                 = 0,</div><div id="wwpID0E01B0HA" class="Code">        .flip_h                 = 0,</div><div id="wwpID0E0ZB0HA" class="Code">        .port                   = TEGRA_CAMERA_PORT_CSI_X_for_sensor,</div><div id="wwpID0E0YB0HA" class="Code">        .lanes                  = number_of_sensor_data_lanes,</div><div id="wwpID0E0XB0HA" class="Code">        .continuous_clk         = 0,</div><div id="wwpID0E0WB0HA" class="Code">};</div><div id="wwpID0E0VB0HA" class="Code">&nbsp;</div><div id="wwpID0E0UB0HA" class="Code">static struct soc_camera_link sensor_iclink = {</div><div id="wwpID0E0TB0HA" class="Code">        .bus_id         = 0,</div><div id="wwpID0E0SB0HA" class="Code">        .board_info     = &amp;t210ref_sensor_camera_i2c_device,</div><div id="wwpID0E0RB0HA" class="Code">        .module_name    = "sensor_v4l2_driver_name",</div><div id="wwpID0E0QB0HA" class="Code">        .i2c_adapter_id = sensor_i2c_bus_number,</div><div id="wwpID0E0PB0HA" class="Code">        .power          = t210ref_sensor_power,</div><div id="wwpID0E0OB0HA" class="Code">        .priv           = &amp;t210ref_sensor_camera_platform_data,</div><div id="wwpID0E0NB0HA" class="Code">};</div><div id="wwpID0E0MB0HA" class="Code">&nbsp;</div><div id="wwpID0E0LB0HA" class="Code">static struct platform_device t210ref_sensor_soc_camera_device = {</div><div id="wwpID0E0KB0HA" class="Code">        .name   = "soc-camera-pdrv",</div><div id="wwpID0E0JB0HA" class="Code">        .id     = 0,</div><div id="wwpID0E0IB0HA" class="Code">        .dev    = {</div><div id="wwpID0E0HB0HA" class="Code">                .platform_data = &amp;sensor_iclink,</div><div id="wwpID0E0GB0HA" class="Code">        },</div><div id="wwpID0E0FB0HA" class="Code">};</div><div id="wwpID0E0EB0HA" class="Code">#endif</div><div id="wwpID0E0DB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Finally register the platform device in <span class="Code_Char">t210ref_camera_init()</span>:</div><div id="wwpID0E0CB0HA" class="Code">#if IS_ENABLED(CONFIG_SOC_CAMERA_SENSOR)</div><div id="wwpID0E0BB0HA" class="Code">        platform_device_register(&amp;t210ref_sensor_soc_camera_device);</div><div id="wwpID0E0AB0HA" class="Code">#endif</div><div id="wwpID0E6HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Device tree update</div><div id="wwpID0E5HA" class="List_Continue">Find the new device tree file for the new board and update regulator information appropriate to the hardware configuration of the new board. A good example to look at is:</div><div id="wwpID0E4HA" class="Code">arch/arm64/boot/dts/tegra210-platforms/tegra210-jetson-e-pmic-p2530-0930-e03.dtsi</div><div id="wwpID0E3HA" class="Code">arch/arm64/boot/dts/tegra210-platforms/tegra210-jetson-e-power-fixed-p2530-0930-e03.dtsi</div><div id="wwpID0E2HA" class="Heading_2">Troubleshooting</div><div id="wwpID0E1HA" class="Body_Text">The following tips can help you troubleshoot the specified issue.</div><div id="wwpID0EZHA" class="FaqDropDown" onclick="WebWorks_ToggleDIV('wwpID0EZHA')">I2C transaction timeout error<script type="text/javascript" language="JavaScript1.2">WebWorks_WriteArrow("wwpID0EZHA", false);</script></div><script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVOpen("wwpID0EZHA", false);</script><div id="wwpID0EYHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Is I2C information wrong?</div><div id="wwpID0EXHA" class="List_Continue">Check the sensor I2C bus number and the sensor I2C device address in the board file.</div><div id="wwpID0EWHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Is sensor power control sequence wrong?</div><div id="wwpID0EVHA" class="List_Continue">Check sensor MCLK setting.</div><div id="wwpID0EUHA" class="List_Continue">Check regulator operations.</div><div id="wwpID0ETHA" class="List_Continue">Check GPIO settings.</div><script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVClose();</script><div id="wwpID0ESHA" class="FaqDropDown" onclick="WebWorks_ToggleDIV('wwpID0ESHA')">Sync point timeout without error<script type="text/javascript" language="JavaScript1.2">WebWorks_WriteArrow("wwpID0ESHA", false);</script></div><script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVOpen("wwpID0ESHA", false);</script><div id="wwpID0ERHA" class="Body_Text">This means Tegra VI/CSI does not receive any data but no error occurs. Verify that the sensor is powered on and streaming data correctly before debugging the Tegra driver.</div><div id="wwpID0EQHA" class="Body_Text">Change settle time value to see if there if some error shows up. These registers must be configured with the right values to get data from the sensor. </div><div id="wwpID0EPHA" class="Code">cil_regs_write(vi2_cam, chan, TEGRA_CSI_CIL_PHY_CONTROL, 0xA);</div><script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVClose();</script><div id="wwpID0EOHA" class="FaqDropDown" onclick="WebWorks_ToggleDIV('wwpID0EOHA')">Sync point timeout with error<script type="text/javascript" language="JavaScript1.2">WebWorks_WriteArrow("wwpID0EOHA", false);</script></div><script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVOpen("wwpID0EOHA", false);</script><div id="wwpID0ENHA" class="Body_Text">Capture the error message and look it up in Tegra&nbsp;X1 TRM for further debugging.</div><div id="wwpID0EMHA" class="Heading_2">Resources</div><div id="wwpID0ELHA" class="Body_Text">Good resources for V4L integration are:</div><div id="wwpID0EKHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Kernel documentation located in:</div><div id="wwpID0EJHA" class="Code">Documentation/video4linux/</div><div id="wwpID0EIHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Linux TV website:</div><div id="wwpID0EHHA" class="List_Continue"><span class="Hyperlink"><a href="http://www.linuxtv.org/" target="external_window">http://www.linuxtv.org/</a></span></div><div id="wwpID0EGHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>soc-camera slides:</div><div id="wwpID0EFHA" class="List_Continue"><span class="Hyperlink"><a href="http://elinux.org/images/f/f2/Soc-camera.pdf" target="external_window">http://elinux.org/images/f/f2/Soc-camera.pdf</a></span></div><div id="wwpID0EEHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Yavta user space V4L2 tool</div><div id="wwpID0EDHA" class="List_Continue"><span class="Hyperlink"><a href="http://git.ideasonboard.org/yavta.git" target="external_window">http://git.ideasonboard.org/yavta.git</a></span></div><div id="wwpID0ECHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Jetson Embedded Platform page</div><div id="wwpID0EBHA" class="List_Continue"><span class="Hyperlink"><a href="http://developer.nvidia.com/embedded-computing" target="external_window">http://developer.nvidia.com/embedded-computing</a></span></div><script type="text/javascript" language="JavaScript1.2">WebWorks_WriteDIVClose();</script><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br><hr color="#DEE4F0"><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b><br>
        Copyright © 2011-2016 by NVIDIA Corporation.
          All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray">
           PG_06076-R24<br>
        Revised: 11 May 2016
        </font></td></tr></table></footer></body></html>