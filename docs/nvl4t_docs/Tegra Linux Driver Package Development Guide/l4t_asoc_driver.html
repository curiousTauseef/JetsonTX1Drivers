<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>NVIDIA Tegra Linux Driver Package Development Guide</title><link rel="Prev" href="l4t_video_for_linux.html" title="Previous"><link rel="Next" href="l4t_toolchain.html" title="Next"><link rel="StyleSheet" href="css/l4t_asoc_driver.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/l4t_asoc_driver_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN0IdFO76itkgdIYuR93Mt9g" class="ww_skin_page_body" style="background-attachment: scroll; background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html');"><header><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0"></td><td class="Header_Right">
           Tegra Linux Driver Package<br>
           Development Guide <br><font size="-1">May 16, 2016 | 24.1 Release</font></td></tr></table></div><!--     <br clear="all">
 --><hr color="#DEE4F0"><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E05S0HA" class="Heading_1">Tegra ASoC Driver</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E01S0HA">ALSA</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0WS0HA">Tegra ASoC Driver Overview</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0RS0HA">DAPM</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0JS0HA">Device Tree</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0DS0HA">Audio Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E06R0HA">Tegra Audio Hub</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0OR0HA">Tegra Platform Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0DP0HA">Tegra Codec Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0VN0HA">Tegra Machine Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0YF0HA">Dynamic Audio Routing</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0FF0HA">Codec Driver Instantiation via Device Tree</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0EE0HA">TDM Slot Mapping</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E03D0HA">Clocking and Power Management</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0QC0HA">Audio Playback/Record Examples</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0NC0HA">Troubleshooting</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0QB0HA">Miscellaneous Examples</a></div></dd></dl></div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 23.4pt; width: 391.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 81pt"><div id="wwpID0EABA04S0HA" class="Normal" style="margin-bottom: 2pt; margin-top: 2pt"><span style="color: #FFFFFF; font-family: &quot;Trebuchet MS&quot;; font-size: 12pt; font-weight: bold">DISCLAIMER:</span></div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 310.5pt"><div id="wwpID0EAAA04S0HA" class="Normal" style="margin-bottom: 2pt; margin-top: 2pt"><span style="font-family: &quot;Trebuchet MS&quot;">This document describes hardware functionality present on Tegra X1 and Jetson TX1. Not all hardware functionality may be supported by the software. Review your software documentation to determine availability of software for audio features.</span></div></td></tr></table></div><div id="wwpID0E03S0HA" class="Body_Text">The NVIDIA<span style="font-size: smaller; vertical-align: super">®</span> Tegra<span style="font-size: smaller; vertical-align: super">®</span> ASoC driver is implemented for the Android and Linux operating systems and is intended to work seamlessly with different Tegra devices, using an existing framework called Advanced Linux Sound Architecture (ALSA), which is maintained by the upstream Linux community.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 23.4pt; width: 391.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 81pt"><div id="wwpID0EABA02S0HA" class="Note_Image" style="text-align: left"><span style="font-family: &quot;Trebuchet MS&quot;; font-size: 12pt; font-weight: bold">Note:</span></div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 310.5pt"><div id="wwpID0EAAA02S0HA" class="Normal" style="margin-bottom: 2pt; margin-top: 2pt"><span style="font-family: &quot;Trebuchet MS&quot;">On Jetson TX1, there is no audio codec. Audio output is supported via HDMI audio. Audio input hardware in the development kit is NOT supported.</span></div></td></tr></table></div><div id="wwpID0E01S0HA" class="Heading_2">ALSA</div><div id="wwpID0E0ZS0HA" class="Body_Text">The ALSA framework is a part of the Linux kernel that is supported and maintained by the larger Linux community. This makes it feasible to adapt to the framework, designing a driver that leverages NVIDIA audio routing support. ALSA has a very good collection of sound card drivers, including actual codec drivers for platform ADC and DAC support, and can support adding new codec drivers as well.</div><div id="wwpID0E0YS0HA" class="Body_Text">ALSA also includes libraries and utilities that enable more refined audio control in Linux and Android user space. These include alsamixer, aplay, arecord, tinycap, and others. This enables you to control audio applications without having to interact with kernel space drivers. </div><div id="wwpID0E0XS0HA" class="Body_Text">The following diagram shows the ALSA software hierarchy.</div><div id="wwpID0E0WS0HA" class="Heading_2">Tegra ASoC Driver Overview</div><div class="ww_skin_page_overflow"><div id="wwpID0E0VS0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.01.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0US0HA" class="Body_Text">User space ALSA applications interact with ALSA core (kernel space) through APIs provided by userspace libraries that initialize the actual hardware codecs at the back end of the audio pipeline.</div><div id="wwpID0E0TS0HA" class="Body_Text">More information on the ALSA framework is available at the following link:</div><div id="wwpID0E0SS0HA" class="Code">http://www.alsa-project.org/main/index.php/Main_Page</div><div id="wwpID0E0RS0HA" class="Heading_2">DAPM</div><div id="wwpID0E0QS0HA" class="Body_Text">ALSA is designed to support various functionalities including but not limited to dynamic audio routing to the available PCM devices. The component of ALSA core that provides this support is Dynamic Audio Power Management (DAPM). DAPM controls the power flow into and out of various codec blocks in the audio subsystem, thereby minimizing power consumption. DAPM introduces switches or kernel controls in the form of widgets to turn ON/OFF the power of a module and help manipulate the required bit of the specific register dynamically using user space applications such as aplay, arecord, or alsamixer. The widgets are classified into various groups. </div><div id="wwpID0E0PS0HA" class="Body_Text">More information on the widgets and their applications is available at:</div><div id="wwpID0E0OS0HA" class="Code"><span class="Weblink"><a href="http://www.alsa-project.org/main/index.php/DAPM" target="external_window">http://www.alsa-project.org/main/index.php/DAPM</a></span></div><div id="wwpID0E0NS0HA" class="Code"><span class="Weblink">https://www.kernel.org/doc/Documentation/sound/alsa/soc/DPCM.txt</span></div><div id="wwpID0E0MS0HA" class="Body_Text">In terms of software hierarchy, DAPM is part of the ALSA core as shown in the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0WS0HA" title="Tegra ASoC Driver">Tegra ASoC Driver Overview</a></span> diagram, helping to manage the codec module power efficiently. </div><div id="wwpID0E0LS0HA" class="Body_Text">For details on the clocking and power management in Tegra ASoC driver, see <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E03D0HA" title="Tegra ASoC Driver">Clocking and Power Management</a></span> topic.</div><div id="wwpID0E0KS0HA" class="Body_Text">For more information see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0YF0HA" title="Tegra ASoC Driver">Dynamic Audio Routing</a></span> topic.</div><div id="wwpID0E0JS0HA" class="Heading_2">Device Tree</div><div id="wwpID0E0IS0HA" class="Body_Text">The Device Tree is a data structure which describes devices on the platform. It is passed to the operating system at boot time and allows you to avoid hard coding component details in the operating system. In this way it makes it easier to change hardware configurations without rebuilding the kernel.</div><div id="wwpID0E0HS0HA" class="Body_Text">The data structure contains the name of nodes and properties. Each node can have properties or child nodes, and each property is comprised of a name and more than one value. Device Tree structures must be written in the correct format and according to format rules so that the data structure can be parsed by the operating system.</div><div id="wwpID0E0GS0HA" class="Body_Text">More details on usage of DTS and its script format can be found at:</div><div id="wwpID0E0FS0HA" class="Code"><span class="Hyperlink"><a href="http://www.devicetree.org/Device_Tree_Usage" target="external_window">http://www.devicetree.org/Device_Tree_Usage</a></span></div><div id="wwpID0E0ES0HA" class="Body_Text">For a simple device tree example see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0FF0HA" title="Tegra ASoC Driver">Codec Driver Instantiation via Device Tree</a></span> section of this chapter.</div><div id="wwpID0E0DS0HA" class="Heading_2">Audio Driver</div><div id="wwpID0E0CS0HA" class="Body_Text">The Tegra Audio Driver leverages Tegra Audio Hub (AHUB) hardware acceleration in the form of platform and codec drivers. The ARM peripheral bus interface (ADMAIF) is implemented as a platform driver with PCM interfaces for playback/record and the rest of the AHUB modules such as the Audio Cross Bar (XBAR), Audio Multiplexer (AMX), Audio Demultiplexer (ADX) and Inter-IC sound (I2S) implemented as codec drivers. Each of the drivers is connected to XBAR through Digital Audio Interfaces (DAIs), inside a machine driver, forming an audio hub.</div><div id="wwpID0E0BS0HA" class="Body_Text">The machine driver probe instantiates the sound card device and registers all the PCM interfaces as exposed by ADMAIF. After booting, before we can use these interfaces to playback or record audio, you must set up the audio paths inside XBAR. By default, XBAR has no routing connections at boot, and no DAPM path is complete to power on the corresponding widgets. The XBAR driver introduces MUX widgets for all the audio components and enables you to create any custom routing through kcontrol from user space using the alsamixer utility. If the audio path is not complete, the DAPM path is not closed. Hardware settings are not applied and you might not hear any audio output.</div><div id="wwpID0E0AS0HA" class="Body_Text">For more details on how to set up the route and how to play or record on the PCM interfaces, see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0QC0HA" title="Tegra ASoC Driver">Audio Playback/Record Examples</a></span> section of this document.</div><div id="wwpID0E06R0HA" class="Heading_2">Tegra Audio Hub</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E04R0HA">Tegra Audio Hub Architecture</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0VR0HA">Software Architecture</a></div></dd></dl></div><div id="wwpID0E05R0HA" class="Body_Text">In this section, we provide an overview of the audio hub hardware architecture inside the Tegra SoC and describe the software architecture of the driver.</div><div id="wwpID0E04R0HA" class="Heading_3">Tegra Audio Hub Architecture</div><div class="ww_skin_page_overflow"><div id="wwpID0E03R0HA" class="Normal"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.02.jpg" style="display: inline; left: 0pt; top: 0pt" alt="http://sw-mobile-docs/temp/V3Le/NVIDIA%20Vibrante%20Linux%20Parker-Engineering%20Development%20Guide/images/asoc_driver.1.02.jpg"></div></div><div id="wwpID0E02R0HA" class="Body_Text">The audio hub contains the modules I2S, SPDIF, and the Digital MIC Controller (DMIC) that interface with the external world. The audio hub also contains Mixer, Sampling Frequency Converter (SFC), Master Volume Control (MVC), Output Processing Engine (OPE), Audio Multiplexers (AMX), Audio Demultiplexers (ADX) and Audio Flow Controllers (AFC). An Audio Direct Memory Access (ADMA) component is included (ADMAIF-DMA) to communicate with memory. The Crossbar (XBAR) facilitates the routing of audio samples through these modules using a proprietary protocol called Audio Client Interface (ACIF).</div><div id="wwpID0E01R0HA" class="Body_Text">The modules in the audio hub support various kinds of audio devices that are expected to interface with the application processor, such as cellular baseband devices, different types of audio CODECs, Bluetooth modules, and A/V receivers. The audio hub is capable of supporting the different interface and signal quality requirements of these devices.</div><div id="wwpID0E0ZR0HA" class="Body_Text">As shown in the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E04R0HA" title="Tegra ASoC Driver">Tegra Audio Hub Architecture</a></span> diagram, each of the AHUB modules has at least one RX port and one TX port, and some have more than one, depending on whether they are for duplex flow such as I2S. The RX ports feed off from XBAR and the TX ports are fed back into XBAR, except in the case of I2S where one end feeds of the actual codec. This configuration makes XBAR a switch where an audio input can be fed to multiple outputs depending on use case.</div><div id="wwpID0E0YR0HA" class="Body_Text">For dynamic audio routing examples see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0QC0HA" title="Tegra ASoC Driver">Audio Playback/Record Examples</a></span> topic.</div><div id="wwpID0E0XR0HA" class="Body_Text">Each ADMAIF has both TX and RX FIFOs that support simultaneous recording and playback. ADMA transfers the data to the ADMAIF FIFO for all audio routing scenarios, as shown in the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E04R0HA" title="Tegra ASoC Driver">Tegra Audio Hub Architecture</a></span> diagram.</div><div id="wwpID0E0WR0HA" class="Body_Text">For details on hardware configuration of each module, refer to the <span style="font-style: italic">Tegra Reference Manual</span>.</div><div id="wwpID0E0VR0HA" class="Heading_3">Software Architecture</div><div id="wwpID0E0UR0HA" class="Body_Text">The software architecture of the Tegra ASoC driver is very similar to the hardware architecture of the AHUB itself, as shown in the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E04R0HA" title="Tegra ASoC Driver">Tegra Audio Hub Architecture</a></span> diagram. This enables you to leverage all the features supported by the hardware and still conform to the ALSA framework. This ALSA System on a Chip (ASoC) driver is comprised of platform, codec and machine drivers.</div><div id="wwpID0E0TR0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Platform driver-This driver is responsible for PCM registration and interfaces with the PCM driver. The ADMAIF is the platform driver.</div><div id="wwpID0E0SR0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Codec driver-Any driver that registers snd_soc_codec_driver structure with the ASoC core can be viewed as the codec driver. The module must have at least one input and one output. In addition, the structure provides a way to define your own DAPM widgets for power management and also kcontrols for register setting from user space. All other modules except ADMAIF are implemented as codec drivers.</div><div id="wwpID0E0RR0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Machine driver-This driver connects one or more codec drivers and a PCM driver together for a given platform. </div><div id="wwpID0E0QR0HA" class="Body_Text">For details on how to write a machine driver and identify a sound card, see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0VN0HA" title="Tegra ASoC Driver">Tegra Machine Driver</a></span> topic and the kernel documentation for AsoC framework at:</div><div id="wwpID0E0PR0HA" class="Code"><span class="Hyperlink">https://www.kernel.org/doc/Documentation/sound/alsa/soc/</span></div><div id="wwpID0E0OR0HA" class="Heading_2">Tegra Platform Driver</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0MR0HA">ADMAIF</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0JR0HA">Playback Hardware Devices in the Tegra ASoC Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0GQ0HA">Capture Hardware Devices in the Tegra ASoC Driver</a></div></dd></dl></dl></div><div id="wwpID0E0NR0HA" class="Body_Text">The Tegra platform driver realizes the number of ports of playback and capture possible inside the AHUB. Some or all of these ports can connected to form a full audio routing path. You must complete these paths as described in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0QC0HA" title="Tegra ASoC Driver">Audio Playback/Record Examples</a></span>.</div><div id="wwpID0E0MR0HA" class="Heading_3">ADMAIF</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0JR0HA">Playback Hardware Devices in the Tegra ASoC Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0GQ0HA">Capture Hardware Devices in the Tegra ASoC Driver</a></div></dd></dl></div><div id="wwpID0E0LR0HA" class="Body_Text">In the Tegra ASoC driver, ADMAIF is implemented as a platform driver and interfaces with the PCM driver. The PCM driver helps perform DMA operations by overriding the function pointers exposed by the <span class="Code_Char">snd_pcm_ops</span> structure. The PCM driver is platform agnostic and interacts only with the SOC DMA engine upstream APIs. The DMA engine then interacts with the platform specific DMA driver to get the correct DMA settings. The ADMAIF platform driver defines DAIs and registers the same with ASoC core.</div><div id="wwpID0E0KR0HA" class="Body_Text">In Tegra X1, there are 10 ADMAIFs. Each ADMAIF is bi-directional, facilitating 10 streams of playback and 10 streams of capture.</div><div id="wwpID0E0JR0HA" class="Heading_4">Playback Hardware Devices in the Tegra ASoC Driver</div><div id="wwpID0E0IR0HA" class="Code" style="margin-left: 36pt">**** List of PLAYBACK Hardware Devices ****</div><div id="wwpID0E0HR0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 0: ADMAIF1 CIF ADMAIF1-0 []</div><div id="wwpID0E0GR0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0FR0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0ER0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 1: ADMAIF2 CIF ADMAIF2-1 []</div><div id="wwpID0E0DR0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0CR0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0BR0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 2: ADMAIF3 CIF ADMAIF3-2 []</div><div id="wwpID0E0AR0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E06Q0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E05Q0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 3: ADMAIF4 CIF ADMAIF4-3 []</div><div id="wwpID0E04Q0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E03Q0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E02Q0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 4: ADMAIF5 CIF ADMAIF5-4 []</div><div id="wwpID0E01Q0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0ZQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0YQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 5: ADMAIF6 CIF ADMAIF6-5 []</div><div id="wwpID0E0XQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0WQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0VQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 6: ADMAIF7 CIF ADMAIF7-6 []</div><div id="wwpID0E0UQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0TQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0SQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 7: ADMAIF8 CIF ADMAIF8-7 []</div><div id="wwpID0E0RQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0QQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0PQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 8: ADMAIF9 CIF ADMAIF9-8 []</div><div id="wwpID0E0OQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0NQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0MQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 9: ADMAIF10 CIF ADMAIF10-9[]</div><div id="wwpID0E0LQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0KQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0JQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 93: ADSP PCM ADSP-FE1-93 []</div><div id="wwpID0E0IQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0HQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0GQ0HA" class="Heading_4">Capture Hardware Devices in the Tegra ASoC Driver</div><div id="wwpID0E0FQ0HA" class="Code" style="margin-left: 36pt">**** List of CAPTURE Hardware Devices ****</div><div id="wwpID0E0EQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 0: ADMAIF1 CIF ADMAIF1-0 []</div><div id="wwpID0E0DQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0CQ0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0BQ0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 1: ADMAIF2 CIF ADMAIF2-1 []</div><div id="wwpID0E0AQ0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E06P0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E05P0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 2: ADMAIF3 CIF ADMAIF3-2 []</div><div id="wwpID0E04P0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E03P0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E02P0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 3: ADMAIF4 CIF ADMAIF4-3 []</div><div id="wwpID0E01P0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0ZP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0YP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 4: ADMAIF5 CIF ADMAIF5-4 []</div><div id="wwpID0E0XP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0WP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0VP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 5: ADMAIF6 CIF ADMAIF6-5 []</div><div id="wwpID0E0UP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0TP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0SP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 6: ADMAIF7 CIF ADMAIF7-6 []</div><div id="wwpID0E0RP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0QP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0PP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 7: ADMAIF8 CIF ADMAIF8-7 []</div><div id="wwpID0E0OP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0NP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0MP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 8: ADMAIF9 CIF ADMAIF9-8 []</div><div id="wwpID0E0LP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0KP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0JP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 9: ADMAIF10 CIF ADMAIF10-9[]</div><div id="wwpID0E0IP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0HP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0GP0HA" class="Code" style="margin-left: 36pt">card 0: tegrasndt210ref [tegra-snd-t210ref], device 93: ADSP PCM ADSP-FE1-93 []</div><div id="wwpID0E0FP0HA" class="Code" style="margin-left: 36pt">  Subdevices: 1/1</div><div id="wwpID0E0EP0HA" class="Code" style="margin-left: 36pt">  Subdevice #0: subdevice #0</div><div id="wwpID0E0DP0HA" class="Heading_2">Tegra Codec Driver</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E04O0HA">XBAR</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0ZO0HA">AMX</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0XO0HA">AMX Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0VO0HA">ADX</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0TO0HA">ADX Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0RO0HA">I2S</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0PO0HA">I2S Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0NO0HA">Mixer</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0LO0HA">Mixer Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0JO0HA">SFC</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0HO0HA">SFC Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0FO0HA">SPDIF</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0DO0HA">SPDIF Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0BO0HA">DMIC</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E06N0HA">DMIC Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E04N0HA">MVC</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E02N0HA">MVC Codec Driver Internals</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0ZN0HA">OPE</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0XN0HA">OPE Codec Driver Internals</a></div></dd></dl></dl></div><div id="wwpID0E0CP0HA" class="Body_Text">A small overview of codec drivers is presented in the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E06R0HA" title="Tegra ASoC Driver">Tegra Audio Hub</a></span> section of this document. In the Tegra ASoC driver implementation, the rest of the AHUB modules, except ADMAIF, are implemented as codec drivers.</div><div id="wwpID0E0BP0HA" class="Body_Text">Their responsibilities include:</div><div id="wwpID0E0AP0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Interface to other modules by defining DAIs.</div><div id="wwpID0E06O0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Define DAPM widgets and establish DAPM routes for dynamic power switching.</div><div id="wwpID0E05O0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Expose additional kcontrols (kernel controls) as needed for user space utilities to dynamically control module behavior.</div><div id="wwpID0E04O0HA" class="Heading_3">XBAR</div><div id="wwpID0E03O0HA" class="Body_Text">The XBAR codec driver defines RX, TX and MUX widgets for all the interfacing modules such as ADMAIF, AMX, ADX, I2S, SPDIF, DMIC, Mixer, SFC, MVC, OPE and AFC. MUX widgets are permanently routed to the corresponding TX widgets inside  the <span class="Code_Char">snd_soc_dapm_route</span> structure.</div><div id="wwpID0E02O0HA" class="Body_Text">However, the XBAR interconnections are made by connecting any RX widget block to any MUX widget block as needed using the alsamixer utility. The get/put handlers for these widgets are implemented so that audio connections are stored by setting the appropriate bit in the hardware MUX register.</div><div id="wwpID0E01O0HA" class="Body_Text">For more information see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0QC0HA" title="Tegra ASoC Driver">Audio Playback/Record Examples</a></span> topic and the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0YF0HA" title="Tegra ASoC Driver">Dynamic Audio Routing</a></span> topic.</div><div id="wwpID0E0ZO0HA" class="Heading_3">AMX</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0XO0HA">AMX Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0YO0HA" class="Body_Text">An Audio Multiplexer (AMX) module can multiplex up to 4 streams of 16 channels, 32 bits each, into one time-division multiplexed (TDM) stream of 16 channels and 32 bits. The 4 RX ports of AMX originate from XBAR and 1 TX port feeds into XBAR. The DAPM widgets exposed are as shown in the following diagram. The DAPM routes established using these widgets are shown in the dotted lines.</div><div id="wwpID0E0XO0HA" class="Heading_4">AMX Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0WO0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.03.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0VO0HA" class="Heading_3">ADX</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0TO0HA">ADX Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0UO0HA" class="Body_Text">An Audio Demultiplexer (ADX) module can de-multiplex a single TDM stream of 16 channels and 32 bits into 4 streams of up to 16 channels, 32 bits each. The 1 RX port of ADX originates from XBAR and 4 TX ports feeds into XBAR. The DAPM widgets exposed are as shown in the following diagram. The DAPM routes established using these widgets are shown in the dotted lines.</div><div id="wwpID0E0TO0HA" class="Heading_4">ADX Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0SO0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.04.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0RO0HA" class="Heading_3">I2S</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0PO0HA">I2S Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0QO0HA" class="Body_Text">An I2S module supports 6 different modes, the most useful of which are I2S and TDM. When I2S is configured in TDM mode, we can use AMX and ADX for multiplexing and demultiplexing audio streams. I2S module can also be in I2S mode if the physical codec interfaced does not support TDM mode of operation. An I2S codec driver supports bidirectional data flow and thus defines CIF and DAP RX/TX widgets as shown in the following diagram. The CIF side of I2S, interfaces with XBAR and DAP side is meant to interface with the physical codec on the given platform. The DAPM routes established using these widgets are shown in the dotted lines. I2S modules also expose kernel control to enable internal I2S loopback.</div><div id="wwpID0E0PO0HA" class="Heading_4">I2S Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0OO0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.05.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0NO0HA" class="Heading_3">Mixer</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0LO0HA">Mixer Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0MO0HA" class="Body_Text">The Mixer can mix audio streams from any of the 10 XBAR-originating input ports to any of the 5 output ports. The DAPM widgets and routes for Mixer are shown in the following diagram. The Mixer driver also exposes Rx Gain and Mixer Enable as additional kcontrols to set the volume of each input stream and to globally enable or disable the Mixer itself.</div><div id="wwpID0E0LO0HA" class="Heading_4">Mixer Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0KO0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.06.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0JO0HA" class="Heading_3">SFC</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0HO0HA">SFC Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0IO0HA" class="Body_Text">The Sampling Frequency Converter(SFC) can convert the input sampling frequency to the required sampling rate. SFC has one input port and one output port which are connected to XBAR. The DAPM widgets and routes for SFC are shown in the following diagram.</div><div id="wwpID0E0HO0HA" class="Heading_4">SFC Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0GO0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.07.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0FO0HA" class="Heading_3">SPDIF</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0DO0HA">SPDIF Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0EO0HA" class="Body_Text">The SPDIF driver is very similar to I2S in terms of the DAPM widgets that are exposed and the routing setup. SPDIF is also bidirectional and adapts to the sampling rate of the incoming data. It is implemented as described in the following diagram.</div><div id="wwpID0E0DO0HA" class="Heading_4">SPDIF Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0CO0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.08.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0BO0HA" class="Heading_3">DMIC</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E06N0HA">DMIC Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0AO0HA" class="Body_Text">It is beneficial to interface directly to digital microphones and speakers via pulse-density modulation (PDM), thus avoiding the need for a PDM-capable external codec. The DMIC controller implements a converter to convert PDM (Pulse density modulation) signals to PCM (Pulse code modulation) signals. The DAPM widgets and routes are as shown below.</div><div id="wwpID0E06N0HA" class="Heading_4">DMIC Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E05N0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.09.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E04N0HA" class="Heading_3">MVC</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E02N0HA">MVC Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E03N0HA" class="Body_Text">MVC provides gain or attenuation to a digital signal path. The digital volume control block is a generic block. It can be used in input or output digital signal path. It can also be used for per-stream volume control and master volume control. The DAPM widgets and routes as shown below.</div><div id="wwpID0E02N0HA" class="Heading_4">MVC Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E01N0HA" class="Caption" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.10.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0ZN0HA" class="Heading_3">OPE</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0XN0HA">OPE Codec Driver Internals</a></div></dd></dl></div><div id="wwpID0E0YN0HA" class="Body_Text">The Output Processing Engine (OPE) is a client of AHUB. OPE contains PEQ and MBDRC which have a scalable number of BiQuad stages, support stereo, 5p1 and 7p1 channels, and meet ultra-low power(ULP) audio requirements. The DAPM widgets and routes are shown in the following diagram.</div><div id="wwpID0E0XN0HA" class="Heading_4">OPE Codec Driver Internals</div><div class="ww_skin_page_overflow"><div id="wwpID0E0WN0HA" class="Body_Text" style="text-align: center"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.11.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0VN0HA" class="Heading_2">Tegra Machine Driver</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0KL0HA">Tegra X1</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0IL0HA">Machine Specific DAI links</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0FG0HA">Audio Path</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0CG0HA">Tegra X1 Audio Path</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0AG0HA">XBAR Route Setting forTegra X1</a></div></dd></dl></dl></div><div id="wwpID0E0UN0HA" class="Body_Text">The Tegra machine driver connects the codec drivers by linking the DAIs exposed by each module described in previous chapter. It defines the <span class="Code_Char">snd_soc_dai_link</span> structure and instantiates the sound card.</div><div id="wwpID0E0TN0HA" class="Body_Text">In general, machine driver responsibilities include:</div><div id="wwpID0E0SN0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Populate the <span class="Code_Char">snd_soc_dai_link</span> structure with appropriate CPU and CODEC DAIs</div><div id="wwpID0E0RN0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Physical codec clock setting (if any) and codec initializations</div><div id="wwpID0E0QN0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Master/slave configurations (if any)</div><div id="wwpID0E0PN0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Define DAPM widgets to route through the physical codec internals and complete DAPM path as needed</div><div id="wwpID0E0ON0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Propagate the runtime sampling frequency to the individual codec drivers as needed</div><div id="wwpID0E0NN0HA" class="Body_Text">This section describes how to use the generic machine driver for a given platform and instantiate a sound card.</div><div id="wwpID0E0MN0HA" class="Body_Text">To adapt the generic machine driver template to a given platform, you must initialize the platform data structure in the device tree structure file shown below. It is important to gather some information about the hardware platform. You must identify the physical codecs present on board and the I2S instance they interface with in the hardware. Refer to hardware schematics for the platform to obtain this information.</div><div id="wwpID0E0LN0HA" class="Code">sound_ref {</div><div id="wwpID0E0KN0HA" class="Code">         compatible = " ";</div><div id="wwpID0E0JN0HA" class="Code">         nvidia,model = " ";</div><div id="wwpID0E0IN0HA" class="Code">         nvidia,num-codec-link = &lt; &gt;;</div><div id="wwpID0E0HN0HA" class="Code">         nvidia,num-amx = &lt; &gt;;</div><div id="wwpID0E0GN0HA" class="Code">         nvidia,num-adx = &lt; &gt;;</div><div id="wwpID0E0FN0HA" class="Code">         nvidia,amx-slot-size = &lt; &gt;;</div><div id="wwpID0E0EN0HA" class="Code">         nvidia,adx-slot-size = &lt; &gt;;</div><div id="wwpID0E0DN0HA" class="Code">         nvidia,amx-slot-map = &lt; &gt;;</div><div id="wwpID0E0CN0HA" class="Code">         nvidia,adx-slot-map = &lt; &gt;;</div><div id="wwpID0E0BN0HA" class="Code">&nbsp;</div><div id="wwpID0E0AN0HA" class="Code">         nvidia,audio-routing = ;</div><div id="wwpID0E06M0HA" class="Code">         nvidia,xbar = &lt;&amp;tegra_axbar&gt;;</div><div id="wwpID0E05M0HA" class="Code">&nbsp;</div><div id="wwpID0E04M0HA" class="Code">         nvidia,dai-link-1 {</div><div id="wwpID0E03M0HA" class="Code">               link-name = " ";</div><div id="wwpID0E02M0HA" class="Code">               cpu-dai = &lt; &gt;;</div><div id="wwpID0E01M0HA" class="Code">               codec-dai = &lt; &gt;;</div><div id="wwpID0E0ZM0HA" class="Code">               cpu-dai-name = " ";</div><div id="wwpID0E0YM0HA" class="Code">               codec-dai-name = " ";</div><div id="wwpID0E0XM0HA" class="Code">               tx-mask = &lt; &gt;;</div><div id="wwpID0E0WM0HA" class="Code">               rx-mask = &lt; &gt;;</div><div id="wwpID0E0VM0HA" class="Code">               format = " ";</div><div id="wwpID0E0UM0HA" class="Code">               bitclock-slave;</div><div id="wwpID0E0TM0HA" class="Code">               frame-slave;</div><div id="wwpID0E0SM0HA" class="Code">               bitclock-noninversion;</div><div id="wwpID0E0RM0HA" class="Code">               frame-noninversion;</div><div id="wwpID0E0QM0HA" class="Code">               bit-format = " ";</div><div id="wwpID0E0PM0HA" class="Code">               bclk_ratio = &lt; &gt;;</div><div id="wwpID0E0OM0HA" class="Code">               srate = &lt; &gt;;</div><div id="wwpID0E0NM0HA" class="Code">               num-channel = &lt; &gt;;</div><div id="wwpID0E0MM0HA" class="Code">               name-prefix = " ";</div><div id="wwpID0E0LM0HA" class="Code">         };</div><div id="wwpID0E0KM0HA" class="Code">   };</div><div id="wwpID0E0JM0HA" class="Body_Text">The <span class="Code_Char">sound</span> node is added to the DT file for sound card registration and passing platform related data. To bind a device driver to a specific device in a DT file, each node must define a <span class="Code_Char">compatible</span> property, which is a list of strings. The optional <span class="Code_Char">nvidia,model</span> property is used for the sound card name. The <span class="Code_Char">nvidia,num-codec-link</span> property shows the number of dai links exposed  outside of the Tegra devices such as I2S, SPDIF or DMIC. This is the same as the number of <span class="Code_Char">nvidia,dai-link-&lt;number&gt;</span> child nodes.</div><div id="wwpID0E0IM0HA" class="Body_Text">In Tegra X1 devices, each AMX and ADX has two modules, nvidia,num-amx and nvidia,num-adx. These indicate the total number of AMX and ADX to be registered by the machine driver. The nvidia,amx-slot-size and nvidia,adx-slot-size properties indicate the slot map size of each module,  which is related to the size of nvidia,amx-slot-map and nvidia,adx-slot-map. The machine driver uses the default value for each property to support stereo 16 bits while initiating AMX and ADX modules unless the above properties are overridden.</div><div id="wwpID0E0HM0HA" class="Body_Text">The <span class="Code_Char">nvidia,dai-link-&lt;number&gt;</span> node is initialized based on I2S and physical codec links as shown above. You can replace the codec with a dummy <span class="Code_Char">spdif-dit.0</span> codec. In that case, you must program the physical codecs at the required sampling rate and operational modes either through a separate utility or by adding necessary <span class="Code_Char">hw_params</span> API calls inside the machine driver.  The <span class="Code_Char">link-name</span> property represents each DAI link, and differentiates the codecs connected to the different I2S instances.</div><div id="wwpID0E0GM0HA" class="Body_Text">The bitclock-slave, frame-slave, format, bitclock-noninverstion and frame-noninversion properties set I2S in I2S/TDM formats and/or master/slave modes. The bclk-ratio property is available to configure the I2S bit clock sample rate. The srate and num-channel properties indicate I2S LRCK and the number of channels in one frame. DAPM routes are initialized as established in  nvidia,audio-routing property.</div><div id="wwpID0E0FM0HA" class="Heading_5">To populate the snd_soc_dai_link structure in the machine driver</div><div id="wwpID0E0EM0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Initialize all XBAR related DAI links common to any machine driver. Use the APIs in the utility file tegra_asoc_machine_alt.h in the machine driver probe function as shown in the following example:</div><div id="wwpID0E0DM0HA" class="Code">/* get the xbar dai link structure */</div><div id="wwpID0E0CM0HA" class="Code">tegra_machine_dai_links=  </div><div id="wwpID0E0BM0HA" class="Code">	tegra_machine_get_dai_link();</div><div id="wwpID0E0AM0HA" class="Code">&nbsp;</div><div id="wwpID0E06L0HA" class="Code">/* set AMX/ADX dai_init */</div><div id="wwpID0E05L0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_AMX1,</div><div id="wwpID0E04L0HA" class="Code">	&amp;tegra_t210ref_amx1_dai_init);</div><div id="wwpID0E03L0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_ADX1,</div><div id="wwpID0E02L0HA" class="Code">	&amp;tegra_t210ref_adx1_dai_init);</div><div id="wwpID0E01L0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_AMX2,</div><div id="wwpID0E0ZL0HA" class="Code">	&amp;tegra_t210ref_amx2_dai_init);</div><div id="wwpID0E0YL0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_ADX2,</div><div id="wwpID0E0XL0HA" class="Code">	&amp;tegra_t210ref_adx2_dai_init);</div><div id="wwpID0E0WL0HA" class="Code">&nbsp;</div><div id="wwpID0E0VL0HA" class="Code">/* set sfc dai_init */</div><div id="wwpID0E0UL0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_SFC1_RX,</div><div id="wwpID0E0TL0HA" class="Code">	&amp;tegra_t210ref_sfc1_init);</div><div id="wwpID0E0SL0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_SFC2_RX,</div><div id="wwpID0E0RL0HA" class="Code">	&amp;tegra_t210ref_sfc2_init);</div><div id="wwpID0E0QL0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_SFC3_RX,</div><div id="wwpID0E0PL0HA" class="Code">	&amp;tegra_t210ref_sfc3_init);</div><div id="wwpID0E0OL0HA" class="Code">tegra_machine_set_dai_init(TEGRA210_DAI_LINK_SFC4_RX,</div><div id="wwpID0E0NL0HA" class="Code">	&amp;tegra_t210ref_sfc4_init);</div><div id="wwpID0E0ML0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>The generic machine driver handles DAI link management based on the initialized platform specific data in the DT file.</div><div id="wwpID0E0LL0HA" class="List_Continue">Because this step is platform/machine dependent, it is discussed with an example in subsequent sections of this chapter.</div><div id="wwpID0E0KL0HA" class="Heading_3">Tegra X1</div><div id="wwpID0E0JL0HA" class="Body_Text">In the Tegra X1 combination of boards, there is one available AD1937s codec. AD1937 supports eight channels in TDM and I2S modes, respectively. The AD1937 codec is connected to I2S4 on P1892. </div><div id="wwpID0E0IL0HA" class="Heading_3">Machine Specific DAI links</div><div id="wwpID0E0HL0HA" class="Body_Text">The platform data structure must be initialized in the DT file so that the machine driver can retrieve the device specific information during the platform probe. The illustration below shows the DAI link diagram for PEDP+ with Tegra X1 where the left side of each DAI is CPU DAI and right side of each DAI is codec DAI in snd_soc_dai_link.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 23.4pt; width: 391.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA0GL0HA" class="Normal" style="margin-bottom: 2pt; margin-top: 2pt; text-align: center"><span style="color: #FFFFFF; font-family: &quot;Trebuchet MS&quot;; font-size: 12pt; font-weight: bold">Note:</span></div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 346.5pt"><div id="wwpID0EAAA0GL0HA" class="Normal" style="margin-bottom: 2pt; margin-top: 2pt"><span style="font-family: &quot;Trebuchet MS&quot;">The following diagram shows the DAI LINK for PEDP+ platform; check the Release Notes for platforms supported in your release.</span></div></td></tr></table></div><div id="wwpID0E0FL0HA" class="Heading_5">DAI LINK In the Machine Driver of PEDP with Tegra X1</div><div class="ww_skin_page_overflow"><div id="wwpID0E0EL0HA" class="Body_Text" style="text-indent: -36pt"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.12.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0DL0HA" class="Code">sound_ref {</div><div id="wwpID0E0CL0HA" class="Code">	compatible = "nvidia,tegra-audio-t210ref";</div><div id="wwpID0E0BL0HA" class="Code">	nvidia,model = "tegra-snd-t210ref";</div><div id="wwpID0E0AL0HA" class="Code">	nvidia,num-codec-link = &lt;1&gt;;</div><div id="wwpID0E06K0HA" class="Code">	nvidia,num-amx = &lt;1&gt;;</div><div id="wwpID0E05K0HA" class="Code">	nvidia,num-adx = &lt;1&gt;;</div><div id="wwpID0E04K0HA" class="Code">	nvidia,amx-slot-size = &lt;32 32&gt;;</div><div id="wwpID0E03K0HA" class="Code">	nvidia,adx-slot-size = &lt;32 32&gt;;</div><div id="wwpID0E02K0HA" class="Code">	nvidia,addr-max9485 = &lt;112&gt;;</div><div id="wwpID0E01K0HA" class="Code">	nvidia,amx-slot-map = &lt;</div><div id="wwpID0E0ZK0HA" class="Code">		/* jack 0 */</div><div id="wwpID0E0YK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0XK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0WK0HA" class="Code">		TDM_SLOT_MAP(0, 1, 0)</div><div id="wwpID0E0VK0HA" class="Code">		TDM_SLOT_MAP(0, 1, 1)</div><div id="wwpID0E0UK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0TK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0SK0HA" class="Code">		TDM_SLOT_MAP(0, 2, 0)</div><div id="wwpID0E0RK0HA" class="Code">		TDM_SLOT_MAP(0, 2, 1)</div><div id="wwpID0E0QK0HA" class="Code">		/* jack 1 */</div><div id="wwpID0E0PK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0OK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0NK0HA" class="Code">		TDM_SLOT_MAP(1, 1, 0)</div><div id="wwpID0E0MK0HA" class="Code">		TDM_SLOT_MAP(1, 1, 1)</div><div id="wwpID0E0LK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0KK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0JK0HA" class="Code">		TDM_SLOT_MAP(1, 2, 0)</div><div id="wwpID0E0IK0HA" class="Code">		TDM_SLOT_MAP(1, 2, 1)</div><div id="wwpID0E0HK0HA" class="Code">		/* jack 2 */</div><div id="wwpID0E0GK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0FK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0EK0HA" class="Code">		TDM_SLOT_MAP(2, 1, 0)</div><div id="wwpID0E0DK0HA" class="Code">		TDM_SLOT_MAP(2, 1, 1)</div><div id="wwpID0E0CK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0BK0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0AK0HA" class="Code">		TDM_SLOT_MAP(2, 2, 0)</div><div id="wwpID0E06J0HA" class="Code">		TDM_SLOT_MAP(2, 2, 1)</div><div id="wwpID0E05J0HA" class="Code">		/* jack 3 */</div><div id="wwpID0E04J0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E03J0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E02J0HA" class="Code">		TDM_SLOT_MAP(3, 1, 0)</div><div id="wwpID0E01J0HA" class="Code">		TDM_SLOT_MAP(3, 1, 1)</div><div id="wwpID0E0ZJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0YJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0XJ0HA" class="Code">		TDM_SLOT_MAP(3, 2, 0)</div><div id="wwpID0E0WJ0HA" class="Code">		TDM_SLOT_MAP(3, 2, 1)&gt;;</div><div id="wwpID0E0VJ0HA" class="Code">	nvidia,adx-slot-map = &lt;</div><div id="wwpID0E0UJ0HA" class="Code">		/* jack 0 */</div><div id="wwpID0E0TJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0SJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0RJ0HA" class="Code">		TDM_SLOT_MAP(0, 1, 0)</div><div id="wwpID0E0QJ0HA" class="Code">		TDM_SLOT_MAP(0, 1, 1)</div><div id="wwpID0E0PJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0OJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0NJ0HA" class="Code">		TDM_SLOT_MAP(0, 2, 0)</div><div id="wwpID0E0MJ0HA" class="Code">		TDM_SLOT_MAP(0, 2, 1)</div><div id="wwpID0E0LJ0HA" class="Code">		/* jack 1 */</div><div id="wwpID0E0KJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0JJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0IJ0HA" class="Code">		TDM_SLOT_MAP(1, 1, 0)</div><div id="wwpID0E0HJ0HA" class="Code">		TDM_SLOT_MAP(1, 1, 1)</div><div id="wwpID0E0GJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0FJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0EJ0HA" class="Code">		TDM_SLOT_MAP(1, 2, 0)</div><div id="wwpID0E0DJ0HA" class="Code">		TDM_SLOT_MAP(1, 2, 1)</div><div id="wwpID0E0CJ0HA" class="Code">		/* jack 2 */</div><div id="wwpID0E0BJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0AJ0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E06I0HA" class="Code">		TDM_SLOT_MAP(2, 1, 0)</div><div id="wwpID0E05I0HA" class="Code">		TDM_SLOT_MAP(2, 1, 1)</div><div id="wwpID0E04I0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E03I0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E02I0HA" class="Code">		TDM_SLOT_MAP(2, 2, 0)</div><div id="wwpID0E01I0HA" class="Code">		TDM_SLOT_MAP(2, 2, 1)</div><div id="wwpID0E0ZI0HA" class="Code">		/* jack 3 */</div><div id="wwpID0E0YI0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0XI0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0WI0HA" class="Code">		TDM_SLOT_MAP(3, 1, 0)</div><div id="wwpID0E0VI0HA" class="Code">		TDM_SLOT_MAP(3, 1, 1)</div><div id="wwpID0E0UI0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0TI0HA" class="Code">		TDM_SLOT_MAP(0, 0, 0)</div><div id="wwpID0E0SI0HA" class="Code">		TDM_SLOT_MAP(3, 2, 0)</div><div id="wwpID0E0RI0HA" class="Code">		TDM_SLOT_MAP(3, 2, 1)&gt;;</div><div id="wwpID0E0QI0HA" class="Code">&nbsp;</div><div id="wwpID0E0PI0HA" class="Code">	nvidia,audio-routing =</div><div id="wwpID0E0OI0HA" class="Code">		"Headphone-z", 	"z DAC1OUT",</div><div id="wwpID0E0NI0HA" class="Code">		"Headphone-z", 	"z DAC2OUT",</div><div id="wwpID0E0MI0HA" class="Code">		"Headphone-z", 	"z DAC3OUT",</div><div id="wwpID0E0LI0HA" class="Code">		"Headphone-z", 	"z DAC4OUT",</div><div id="wwpID0E0KI0HA" class="Code">		"z ADC1IN",	"LineIn-z";</div><div id="wwpID0E0JI0HA" class="Code">&nbsp;</div><div id="wwpID0E0II0HA" class="Code">	nvidia,xbar = &lt;&amp;tegra_axbar&gt;;</div><div id="wwpID0E0HI0HA" class="Code">&nbsp;</div><div id="wwpID0E0GI0HA" class="Code">	nvidia,dai-link-1 {</div><div id="wwpID0E0FI0HA" class="Code">		link-name = "ad-playback-z";</div><div id="wwpID0E0EI0HA" class="Code">		cpu-dai = &lt;&amp;tegra_i2s4&gt;;</div><div id="wwpID0E0DI0HA" class="Code">		codec-dai = &lt;&amp;ad1937z&gt;;</div><div id="wwpID0E0CI0HA" class="Code">		cpu-dai-name = "I2S4";</div><div id="wwpID0E0BI0HA" class="Code">		codec-dai-name = "ad193x-hifi";</div><div id="wwpID0E0AI0HA" class="Code">		tx-mask = &lt;0xFF&gt;;</div><div id="wwpID0E06H0HA" class="Code">		rx-mask = &lt;0xFF&gt;;</div><div id="wwpID0E05H0HA" class="Code">		format = "dsp_a";</div><div id="wwpID0E04H0HA" class="Code">		bitclock-slave;</div><div id="wwpID0E03H0HA" class="Code">		frame-slave;</div><div id="wwpID0E02H0HA" class="Code">		bitclock-noninversion;</div><div id="wwpID0E01H0HA" class="Code">		frame-noninversion;</div><div id="wwpID0E0ZH0HA" class="Code">		bit-format = "s32_le";</div><div id="wwpID0E0YH0HA" class="Code">		bclk_ratio = &lt;1&gt;;</div><div id="wwpID0E0XH0HA" class="Code">		srate = &lt;48000&gt;;</div><div id="wwpID0E0WH0HA" class="Code">		num-channel = &lt;8&gt;;</div><div id="wwpID0E0VH0HA" class="Code">		name-prefix = "z";</div><div id="wwpID0E0UH0HA" class="Code">	};</div><div id="wwpID0E0TH0HA" class="Code">};</div><div id="wwpID0E0SH0HA" class="Code">&nbsp;</div><div id="wwpID0E0RH0HA" class="Body_Text">The <span style="font-family: &quot;Courier New&quot;">dai_fmt</span> sets I2S4 in TDM master mode. It also connects codec AD1937 with I2S4 DAPM routes and AMX/ADX slot maps initialized. The sound card is named <span class="Code_Char">tegra-snd-t210ref</span>.</div><div id="wwpID0E0QH0HA" class="Body_Text">The DAPM widgets supported in the generic machine driver include Headphone-x, Headphone-y, Headphone-z, Headphone-s, LineIn-x, LineIn-y, LineIn-z, and LineIn-s. Based on how <span class="Code_Char">name_prefix</span> and <span class="Code_Char">dai_fmt</span> are initialized, the DAPM route must be set by parsing the IN/OUT DAPM widgets of the physical codec. Without this, the DAPM path is not complete and audio does not function correctly. The Tegra X1 audio map is shown below.</div><div id="wwpID0E0PH0HA" class="Code">nvidia,audio-routing =</div><div id="wwpID0E0OH0HA" class="Code">		"Headphone-z", 	"z DAC1OUT",</div><div id="wwpID0E0NH0HA" class="Code">		"Headphone-z", 	"z DAC2OUT",</div><div id="wwpID0E0MH0HA" class="Code">		"Headphone-z", 	"z DAC3OUT",</div><div id="wwpID0E0LH0HA" class="Code">		"Headphone-z", 	"z DAC4OUT",</div><div id="wwpID0E0KH0HA" class="Code">		"z ADC1IN",	"LineIn-z",</div><div id="wwpID0E0JH0HA" class="Body_Text">Though we can assign any ADMAIF to any AMX via XBAR, we can fix ADMAIF1 to ADMAIF4 as the inputs of AMX1 are connected to I2S4.</div><div id="wwpID0E0IH0HA" class="Body_Text">The machine driver creates three <span style="font-family: &quot;Courier New&quot;">snd_soc_dai_link</span>s for each	<span style="font-family: &quot;Courier New&quot;">dai-link-&lt;number&gt;</span> node initialized in the DT file and appends them to XBAR DAI links using the utility API. It also initializes the .<span style="font-family: &quot;Courier New&quot;">dai_ops</span> for the ADMAIF interfaces accordingly as shown below.</div><div id="wwpID0E0HH0HA" class="Code">/* set ADMAIF dai_ops */</div><div id="wwpID0E0GH0HA" class="Code">for (i = TEGRA210_DAI_LINK_ADMAIF1;</div><div id="wwpID0E0FH0HA" class="Code">	i &lt;= TEGRA210_DAI_LINK_ADMAIF10; i++)</div><div id="wwpID0E0EH0HA" class="Code">	tegra_machine_set_dai_ops(i, &amp;tegra_t210ref_spdif_ops);</div><div id="wwpID0E0DH0HA" class="Code">&nbsp;</div><div id="wwpID0E0CH0HA" class="Code">for (i = 0; i &lt; machine-&gt;num_codec_links; i++) {</div><div id="wwpID0E0BH0HA" class="Code">	if (tegra_t210ref_codec_links[i].name) {</div><div id="wwpID0E0AH0HA" class="Code">		if (strstr(tegra_t210ref_codec_links[i].name,</div><div id="wwpID0E06G0HA" class="Code">			"ad-playback-z")) {</div><div id="wwpID0E05G0HA" class="Code">			for (j = TEGRA210_DAI_LINK_ADMAIF1;</div><div id="wwpID0E04G0HA" class="Code">				j &lt;= TEGRA210_DAI_LINK_ADMAIF4; j++)</div><div id="wwpID0E03G0HA" class="Code">				tegra_machine_set_dai_ops(j,</div><div id="wwpID0E02G0HA" class="Code">					&amp;tegra_t210ref_ad1937_z_ops);</div><div id="wwpID0E01G0HA" class="Code">		} else if (strstr(tegra_t210ref_codec_links[i].name,</div><div id="wwpID0E0ZG0HA" class="Code">			"ad-playback-x")) {</div><div id="wwpID0E0YG0HA" class="Code">			for (j = TEGRA210_DAI_LINK_ADMAIF5;</div><div id="wwpID0E0XG0HA" class="Code">				j &lt;= TEGRA210_DAI_LINK_ADMAIF8; j++)</div><div id="wwpID0E0WG0HA" class="Code">				tegra_machine_set_dai_ops(j,</div><div id="wwpID0E0VG0HA" class="Code">					&amp;tegra_t210ref_ad1937_x_ops);</div><div id="wwpID0E0UG0HA" class="Code">		} else if (strstr(tegra_t210ref_codec_links[i].name,</div><div id="wwpID0E0TG0HA" class="Code">			"spdif-playback")) {</div><div id="wwpID0E0SG0HA" class="Code">			tegra_machine_set_dai_ops(</div><div id="wwpID0E0RG0HA" class="Code">				TEGRA210_DAI_LINK_ADMAIF9,</div><div id="wwpID0E0QG0HA" class="Code">				&amp;tegra_t210ref_spdif_ops);</div><div id="wwpID0E0PG0HA" class="Code">		}</div><div id="wwpID0E0OG0HA" class="Code">	}</div><div id="wwpID0E0NG0HA" class="Code">}</div><div id="wwpID0E0MG0HA" class="Code">&nbsp;</div><div id="wwpID0E0LG0HA" class="Code">/* append t210ref specific dai_links */</div><div id="wwpID0E0KG0HA" class="Code">card-&gt;num_links =</div><div id="wwpID0E0JG0HA" class="Code">	tegra_machine_append_dai_link(tegra_t210ref_codec_links,</div><div id="wwpID0E0IG0HA" class="Code">		2 * machine-&gt;num_codec_links);</div><div id="wwpID0E0HG0HA" class="Code">tegra_machine_dai_links = tegra_machine_get_dai_link();</div><div id="wwpID0E0GG0HA" class="Code">card-&gt;dai_link = tegra_machine_dai_links;</div><div id="wwpID0E0FG0HA" class="Heading_3">Audio Path</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0CG0HA">Tegra X1 Audio Path</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0AG0HA">XBAR Route Setting forTegra X1</a></div></dd></dl></div><div id="wwpID0E0EG0HA" class="Body_Text">The dai_link connection in the machine driver only connects the platform and codec drivers to XBAR driver. However, to realize any audio output from the physical codecs, you must complete the DAPM path by routing through the internals of XBAR, i.e., connect the RX and MUX widgets.from user space using alsamixer utility as follows. </div><div id="wwpID0E0DG0HA" class="List_Continue"><span class="Strong">Note</span>: The following commands are specific to Tegra X1 and represent the audio path shown in the following diagram. This diagram shows the DAI LINK for PEDP+ platform; check the <span class="Emphasis">Release Notes</span> for platforms supported in your release.</div><div id="wwpID0E0CG0HA" class="Heading_4">Tegra X1 Audio Path</div><div class="ww_skin_page_overflow"><div id="wwpID0E0BG0HA" class="Body_Text" style="text-indent: -36pt"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.13.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0AG0HA" class="Heading_4">XBAR Route Setting forTegra X1</div><div id="wwpID0E06F0HA" class="Code">amixer -c 0 sset 'I2S4 Mux' 'AMX1'</div><div id="wwpID0E05F0HA" class="Code">amixer -c 0 sset 'AMX1-1 Mux' 'ADMAIF1'</div><div id="wwpID0E04F0HA" class="Code">amixer -c 0 sset 'AMX1-2 Mux' 'ADMAIF2'</div><div id="wwpID0E03F0HA" class="Code">amixer -c 0 sset 'AMX1-3 Mux' 'ADMAIF3'</div><div id="wwpID0E02F0HA" class="Code">amixer -c 0 sset 'AMX1-4 Mux' 'ADMAIF4'</div><div id="wwpID0E01F0HA" class="Code">amixer -c 0 sset 'ADX1 Mux' 'I2S4'</div><div id="wwpID0E0ZF0HA" class="Code">amixer -c 0 sset 'ADMAIF1 Mux' 'ADX1-1'</div><div id="wwpID0E0YF0HA" class="Heading_2">Dynamic Audio Routing</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0VF0HA">Case 1: Internal AHUB TDM Path</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0MF0HA">Modify Case 1 to Record on I2S3 (I2S Mode) And Output On I2S4 (TDM Mode)</a></div></dd></dl></div><div id="wwpID0E0XF0HA" class="Body_Text">Instantiation of the sound card after boot indicates that all codec drivers and the platform driver are interconnected using the machine driver. The remaining step before obtaining the audio output on the physical codecs involves routing through the XBAR internals via MUX widgets to complete the DAPM path using the alsamixer utility. To support audio routing dynamically between AHUB modules, this route setting step is performed from user space. This provides flexibility for complicated use cases.</div><div id="wwpID0E0WF0HA" class="Body_Text">For example, <span class="Code_Char">[amixer -c 0 sset ‘I2S1 Mux’ ‘I2S1’]</span> realizes the internal AHUB path I2S1 RX -&gt; XBAR -&gt; I2S1 TX. Similarly, the following are use cases that emphasize dynamic audio route control from user space.</div><div id="wwpID0E0VF0HA" class="Heading_4">Case 1: Internal AHUB TDM Path</div><div id="wwpID0E0UF0HA" class="Body_Text">Path: I2S -&gt; ADX -&gt; AMX -&gt; I2S</div><div id="wwpID0E0TF0HA" class="Body_Text">Commands:</div><div id="wwpID0E0SF0HA" class="Code">amixer -c 0 sset ‘ADX1 Mux’ ‘I2S4’</div><div id="wwpID0E0RF0HA" class="Code">amixer -c 0 sset ‘AMX1-1 Mux’ ‘ADX1-1’</div><div id="wwpID0E0QF0HA" class="Code">amixer -c 0 sset ‘AMX1-2 Mux’ ‘ADX2-2’</div><div id="wwpID0E0PF0HA" class="Code">amixer -c 0 sset ‘AMX1-3 Mux’ ‘ADX3-3’</div><div id="wwpID0E0OF0HA" class="Code">amixer -c 0 sset ‘AMX1-4 Mux’ ‘ADX4-4’</div><div id="wwpID0E0NF0HA" class="Code">amixer -c 0 sset 'I2S4 Mux' 'AMX1'</div><div id="wwpID0E0MF0HA" class="Heading_4">Modify Case 1 to Record on I2S3 (I2S Mode) And Output On I2S4 (TDM Mode)</div><div id="wwpID0E0LF0HA" class="Body_Text">Path: [I2S -&gt; ADX -&gt; AMX -&gt; I2S] + [I2S3 -&gt; AMX -&gt; I2S4]</div><div id="wwpID0E0KF0HA" class="Body_Text">Initially audio records from I2S4 and outputs on I2S4.</div><div id="wwpID0E0JF0HA" class="Body_Text">Commands:</div><div id="wwpID0E0IF0HA" class="Code">amixer -c 0 sset ‘AMX1-1 Mux’ ‘None’</div><div id="wwpID0E0HF0HA" class="Code">amixer -c 0 sset ‘AMX1-1 Mux’ ‘I2S3’</div><div id="wwpID0E0GF0HA" class="Body_Text">After this step, audio records from I2S3 and outputs on I2S4</div><div id="wwpID0E0FF0HA" class="Heading_2">Codec Driver Instantiation via Device Tree</div><div id="wwpID0E0EF0HA" class="Body_Text">Based on architecture, the Makefile in the following directory conditionally compiles the required DTS files into DTB files:</div><div id="wwpID0E0DF0HA" class="Code">$KERNEL_TOP/arch/arm64/boot/dts/</div><div id="wwpID0E0CF0HA" class="Body_Text">When the kernel is flashed, the flash script chooses the required DTS file for parsing during boot, and the ASoC codecs listed in DTS are instantiated. To add any new module instantiation as a requirement, identify and edit the Device Tree script as reported in the <span class="Code_Char">dmesg</span> log on the target as shown in the following example:</div><div id="wwpID0E0BF0HA" class="Code">&lt;6&gt;[    0.000000] Tegra reserved memory:</div><div id="wwpID0E0AF0HA" class="Code">&lt;6&gt;[    0.000000] LP0:                    f25ff000 - f25fffff</div><div id="wwpID0E06E0HA" class="Code">&lt;6&gt;[    0.000000] Bootloader framebuffer: 00000000 - 00000000</div><div id="wwpID0E05E0HA" class="Code">&lt;6&gt;[    0.000000] Bootloader framebuffer2: 00000000 - 00000000</div><div id="wwpID0E04E0HA" class="Code">&lt;6&gt;[    0.000000] Framebuffer:            ef800000 - f09fffff</div><div id="wwpID0E03E0HA" class="Code">&lt;6&gt;[    0.000000] 2nd Framebuffer:        f0a00000 - f19fffff</div><div id="wwpID0E02E0HA" class="Code">&lt;6&gt;[    0.000000] Carveout:               00000000 - 00000000</div><div id="wwpID0E01E0HA" class="Code">&lt;6&gt;[    0.000000] Vpr:                    f4600000 - ffffffff</div><div id="wwpID0E0ZE0HA" class="Code">&lt;6&gt;[    0.000000] Tsec:                   00000000 - 00000000</div><div id="wwpID0E0YE0HA" class="Code">&lt;7&gt;[    0.000000] On node 0 totalpages: 980992</div><div id="wwpID0E0XE0HA" class="Code">&lt;7&gt;[    0.000000]   DMA32 zone: 6244 pages used for memmap</div><div id="wwpID0E0WE0HA" class="Code">&lt;7&gt;[    0.000000]   DMA32 zone: 0 pages reserved</div><div id="wwpID0E0VE0HA" class="Code">&lt;7&gt;[    0.000000]   DMA32 zone: 456704 pages, LIFO batch:31</div><div id="wwpID0E0UE0HA" class="Code">&lt;7&gt;[    0.000000]   Normal zone: 7168 pages used for memmap</div><div id="wwpID0E0TE0HA" class="Code">&lt;7&gt;[    0.000000]   Normal zone: 524288 pages, LIFO batch:31</div><div id="wwpID0E0SE0HA" class="Code">&lt;6&gt;[    0.000000] psci: probing function IDs from device-tree</div><div id="wwpID0E0RE0HA" class="Code">&lt;6&gt;[    0.000000] DTS File Name: /home/juskim/git/android/t210_main/kernel/arch/arm64/boot/dts/tegra210-ers-E2581-1100-a00-00.dts</div><div id="wwpID0E0QE0HA" class="Code">&lt;6&gt;[    0.000000] Tegra21: Speedo/IDDQ fuse revision 0</div><div id="wwpID0E0PE0HA" class="Heading_5">To add new devices for instantiation</div><div id="wwpID0E0OE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Add the device name with the base address and status as “okay”, as shown in the following example.</div><div id="wwpID0E0NE0HA" class="Code">ahub {</div><div id="wwpID0E0ME0HA" class="Code">	status = "okay";</div><div id="wwpID0E0LE0HA" class="Code">	i2s@702d1000 {</div><div id="wwpID0E0KE0HA" class="Code">		pinctrl-names = "dap_active", "dap_inactive";</div><div id="wwpID0E0JE0HA" class="Code">		pinctrl-0 = &lt;&gt;;</div><div id="wwpID0E0IE0HA" class="Code">		pinctrl-1 = &lt;&gt;;</div><div id="wwpID0E0HE0HA" class="Code">		status = "okay";</div><div id="wwpID0E0GE0HA" class="Code">	};</div><div id="wwpID0E0FE0HA" class="Code">};</div><div id="wwpID0E0EE0HA" class="Heading_2">TDM Slot Mapping</div><div id="wwpID0E0DE0HA" class="Body_Text">The Tegra X1 AHUB consists of 2 hardware audio multiplexers (AMX) and demultiplexers (ADX) as described in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E06R0HA" title="Tegra ASoC Driver">Tegra Audio Hub</a></span>. Initialize slot mapping in the platform data as shown in<span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0IL0HA" title="Tegra ASoC Driver">Machine Specific DAI links</a></span>. Without any initialization, the machine driver defaults the slot map for AMX inputs and ADX outputs at 16-bit stereo and 8-channel, 32 bit TDM output. To change the slot mapping of hardware TDMs, adjust the slot map structures in the DT file.</div><div id="wwpID0E0CE0HA" class="Body_Text">As shown in below, AMX can multiplex up to 4 input streams, each of which can be up to 16 channels, 32 bits, into 1 single output stream of 16 channels, 32 bits to form a TDM signal. The capability of ADX is the reverse of AMX.</div><div class="ww_skin_page_overflow"><div id="wwpID0E0BE0HA" class="Body_Text" style="text-indent: -36pt"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.14.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0AE0HA" class="Body_Text">The slot map is an integer array of size 32 that controls the mapping of these input streams to the output stream. The following macro is available:</div><div id="wwpID0E06D0HA" class="Code">#define TDM_SLOT_MAP(stream_id, nth_channel, nth_byte)    \</div><div id="wwpID0E05D0HA" class="Code">        ((stream_id &lt;&lt; 16) | (nth_channel &lt;&lt; 8) | (nth_byte))</div><div id="wwpID0E04D0HA" class="Body_Text">where <span class="Code_Char">stream_id</span> can vary from 0 to 3, <span class="Code_Char">nth_channel</span> can vary from 1 to 16, and <span class="Code_Char">nth_byte</span> can vary from 0 to 3.</div><div id="wwpID0E03D0HA" class="Heading_2">Clocking and Power Management</div><div id="wwpID0E02D0HA" class="Body_Text">The clock tree of the Tegra ASoC driver in the idle state, when no audio record or playback is in progress, is as shown below.</div><div id="wwpID0E01D0HA" class="Code">clock                               state  ref div  rate</div><div id="wwpID0E0ZD0HA" class="Code">--------------------------------------------------------------</div><div id="wwpID0E0YD0HA" class="Code">i2s4_sync                           on     1        24000000</div><div id="wwpID0E0XD0HA" class="Code">i2s3_sync                           on     1        24000000</div><div id="wwpID0E0WD0HA" class="Code"> *audio3                            off    0        24000000</div><div id="wwpID0E0VD0HA" class="Code">i2s2_sync                           on     1        24000000</div><div id="wwpID0E0UD0HA" class="Code">i2s1_sync                           on     1        24000000</div><div id="wwpID0E0TD0HA" class="Code"> *audio1                            off    0        24000000</div><div id="wwpID0E0SD0HA" class="Code">i2s0_sync                           on     1        24000000</div><div id="wwpID0E0RD0HA" class="Code">spdif_in_sync                       on     1        24000000</div><div id="wwpID0E0QD0HA" class="Code"> *audio2_dmic                       off    0        24000000</div><div id="wwpID0E0PD0HA" class="Code"> *audio1_dmic                       off    0        24000000</div><div id="wwpID0E0OD0HA" class="Code"> *audio0_dmic                       off    0        24000000</div><div id="wwpID0E0ND0HA" class="Code"> *audio                             off    0        24000000</div><div id="wwpID0E0MD0HA" class="Code">	*audio_2x                        off    0  x2    48000000</div><div id="wwpID0E0LD0HA" class="Code"> *audio4                            off    0        24000000</div><div id="wwpID0E0KD0HA" class="Code"> *audio2                            off    0        24000000</div><div id="wwpID0E0JD0HA" class="Code"> *audio0                            off    0        24000000</div><div id="wwpID0E0ID0HA" class="Code">osc                                 on     3        38400000</div><div id="wwpID0E0HD0HA" class="Code">  pll_ref                           on     7  1.0   38400000</div><div id="wwpID0E0GD0HA" class="Code">	  pll_a                          on     1  x9.5  368639844</div><div id="wwpID0E0FD0HA" class="Code">		pll_a_out0                 on     1  15.0  24575990</div><div id="wwpID0E0ED0HA" class="Code">		   extern1                 on     3  1.0   24575990</div><div id="wwpID0E0DD0HA" class="Code">			  clk_out_1          on     2  1.0   24575990</div><div id="wwpID0E0CD0HA" class="Code">		   d_audio                 off    0  2.0   12287995</div><div id="wwpID0E0BD0HA" class="Code">		  *dmic3                   off    0  11.0  2234181</div><div id="wwpID0E0AD0HA" class="Code">		  *dmic2                   off    0  11.0  2234181</div><div id="wwpID0E06C0HA" class="Code">		  *dmic1                   off    0  11.0  2234181</div><div id="wwpID0E05C0HA" class="Code">		   spdif_out               off    0  21.0  1170286</div><div id="wwpID0E04C0HA" class="Code">		   i2s4                    off    0  5.5   4468362</div><div id="wwpID0E03C0HA" class="Code">		   i2s3                    off    0  5.50  4468362</div><div id="wwpID0E02C0HA" class="Code">		   i2s1                    off    0  5.50  4468362</div><div id="wwpID0E01C0HA" class="Code">		   i2s0                    off    0  10.50 2340571</div><div id="wwpID0E0ZC0HA" class="Code">     pll_p                          on     15 x10.6 408000000</div><div id="wwpID0E0YC0HA" class="Code">		*spdif_in                  off    0  8.50  48000000</div><div id="wwpID0E0XC0HA" class="Code">		ape                        off    0  2.0   204000000</div><div id="wwpID0E0WC0HA" class="Code">		   xbar.ape                off    0        204000000</div><div id="wwpID0E0VC0HA" class="Code">		   adsp.ape                off    0        204000000</div><div id="wwpID0E0UC0HA" class="Code">		   adma.ape                off    0        204000000</div><div id="wwpID0E0TC0HA" class="Body_Text">The clocks of the individual modules, AMX, ADX, AFC, SFC, MIXER, and others, are internally handled by the APE clock. The clock for the codec drivers I2S and XBAR are switched OFF in idle. They are turned ON when audio playback or recording is in progress. The <span class="Code_Char">idle_bias_off</span> option provided by ASoC core (<span class="Code_Char">snd_soc_codec_driver</span>) is set to 1 in the individual codec drivers for dynamic audio power management. With this option, the ASoC core calls the appropriate <span class="Code_Char">resume()</span> and <span class="Code_Char">suspend()</span> functions in the codec driver that was registered using <span class="Code_Char">SET_RUNTIME_PM_OPS</span> during platform probe.</div><div id="wwpID0E0SC0HA" class="Body_Text">The suspend and resume APIs are called when playback or record stops or starts. The suspend API caches the register map and disables the clock. The resume API enables the clock and then syncs the register map from the cache.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 23.4pt; width: 391.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA0RC0HA" class="Note_Image"><span style="font-family: &quot;Trebuchet MS&quot;; font-size: 12pt; font-weight: bold">Note:</span></div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 346.5pt"><div id="wwpID0EAAA0RC0HA" class="Normal" style="margin-bottom: 2pt; margin-top: 2pt"><span style="font-family: &quot;Trebuchet MS&quot;">Volatile registers are not synced in this process. Those registers must be reprogrammed after the clock is re-enabled. The internal mapping RAM FIFOs, if any, are cleared during every suspend/resume cycle. The RAM configuration must be restored as well during this process.</span></div></td></tr></table></div><div id="wwpID0E0QC0HA" class="Heading_2">Audio Playback/Record Examples</div><div id="wwpID0E0PC0HA" class="Body_Text">To test audio playback and record scenarios, make sure the XBAR route is set up using alsamixer commands, based on the platform. The following provides the sample testing commands for audio playback and record scenarios.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 41.75pt; width: 401.75pt" cellspacing="0" summary=""><tr><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 179.65pt"><div id="wwpID0EABF0OC0HA" class="Cell_Heading"><span class="Strong">Command</span></div></td><td style="background-color: #DDEEBF; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 222.1pt"><div id="wwpID0EAAF0OC0HA" class="Cell_Heading"><span class="Strong">Result</span></div></td></tr><tr><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABE0OC0HA" class="Cell_Text">aplay -D  AUDIO_OUT0 sample.wav</div></td><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAE0OC0HA" class="Cell_Text">Audio output from AUDIO_OUT0 on e1892.</div></td></tr><tr><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABD0OC0HA" class="Cell_Text">aplay -D AUDIO_OUT1  sample.wav</div></td><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAD0OC0HA" class="Cell_Text">Audio output from AUDIO_OUT1 on e1892.</div></td></tr><tr><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABC0OC0HA" class="Cell_Text">aplay -D AUDIO_OUT2  sample.wav</div></td><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAC0OC0HA" class="Cell_Text">Audio output from AUDIO_OUT2 on e1892.</div></td></tr><tr><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABB0OC0HA" class="Cell_Text">aplay -D AUDIO_OUT3  sample.wav</div></td><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAB0OC0HA" class="Cell_Text">Audio output from AUDIO_OUT3 on e1892.</div></td></tr><tr><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABA0OC0HA" class="Cell_Text">arecord -D AUDIO_IN -f dat -d 30 record_result.wav</div></td><td style="border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAA0OC0HA" class="Cell_Text">Audio recorded as input from AUDIO_IN on E1892 and saved to file record_result.wav.</div></td></tr></table></div><div id="wwpID0E0NC0HA" class="Heading_2">Troubleshooting</div><div id="wwpID0E0MC0HA" class="Body_Text">The following issues can be overcome using the described solutions.</div><div id="wwpID0E0LC0HA" class="Heading_5">Issue 1: No Sound Cards Found</div><div id="wwpID0E0KC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Identify the ASoC error that lead to no sound card detection with the dmesg [dmesg | grep ASoC] command. Output is similar to the following:</div><div id="wwpID0E0JC0HA" class="Code">[4.874720] tegra-audio-t210ref tegra-audio-t210ref.0: ASoC: no source widget found for x OUT</div><div id="wwpID0E0IC0HA" class="Code">[4.874724] tegra-audio-t210ref tegra-audio-t210ref.0: ASoC: Failed to add route x OUT-&gt; direct-&gt; Headphone-x</div><div id="wwpID0E0HC0HA" class="Code">[4.874736] tegra-audio-t210ref tegra-audio-t210ref.0: ASoC: no sink widget found for x IN</div><div id="wwpID0E0GC0HA" class="Code">[4.874739] tegra-audio-t210ref tegra-audio-t210ref.0: ASoC: Failed to add route LineIn-x-&gt; direct-&gt; x IN</div><div id="wwpID0E0FC0HA" class="List_Continue">In this case, <span class="Code_Char">x OUT</span> and <span class="Code_Char">x IN</span> are the widgets of the <span class="Code_Char">spdif-dit</span> dummy codec. It might have not been instantiated in ASoC. Confirm that with the following command:</div><div id="wwpID0E0EC0HA" class="Code">cat /sys/kernel/debug/asoc/codecs</div><div id="wwpID0E0DC0HA" class="List_Continue">if <span class="Code_Char">spdif-dit</span> is instantiated. The <span class="Code_Char">spdif</span> device must be instantiated using <span class="Code_Char">platform_register</span> in the board-specific file.</div><div id="wwpID0E0CC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>If output from the <span class="Code_Char">dmesg [dmesg | grep ASoC]</span> command is similar to the following: </div><div id="wwpID0E0BC0HA" class="Code">[4.874720] tegra-audio-t210ref tegra-audio-t210ref.0: ASoC: CPU DAI DAP not registered</div><div id="wwpID0E0AC0HA" class="Body_Text">In this case, “DAP” is the CPU DAI for the I2S to codec dai link. The I2S codec may not be instantiated in ASoC. Confirm that with the following command:</div><div id="wwpID0E06B0HA" class="Code">cat /sys/kernel/debug/asoc/codecs</div><div id="wwpID0E05B0HA" class="Body_Text">if tegra30-i2s is instantiated.</div><div id="wwpID0E04B0HA" class="Body_Text">Identification of the DAI link at the point of failure would give a clue on the I2S instance number that failed to instantiate. Accordingly, the I2S codec driver can be instantiated by providing a suitable entry point in DTS file as described in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0FF0HA" title="Tegra ASoC Driver">Codec Driver Instantiation via Device Tree</a></span>.</div><div id="wwpID0E03B0HA" class="Heading_5">Issue 2: Sound Not Audible</div><div id="wwpID0E02B0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Confirm if the DAPM path is completed. Check the path using alsamixer utility as described in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0FG0HA" title="Tegra ASoC Driver">Audio Path</a></span>.</div><div id="wwpID0E01B0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Confirm the pinmux setting for I2S master/slave mode. Check the following files. </div><div id="wwpID0E0ZB0HA" class="Code">arch/arm64/boot/dts/tegra210-foster-e-p2530-common.dtsi</div><div id="wwpID0E0YB0HA" class="Code">arch/arm64/boot/dts/tegra210-platforms/tegra210-foster-e-pinmux-p2530-0930-e00.dtsi </div><div id="wwpID0E0XB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Confirm the <span class="Code_Char">status</span> property of i2s is set to <span class="Code_Char">okay</span> in the following file:</div><div id="wwpID0E0WB0HA" class="Code">arch/arm64/boot/dts/tegra210-common.dtsi</div><div id="wwpID0E0VB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Confirm the clock settings for I2S master/slave mode. Probe the Frame sync (FS) and bit clock (BCLK) of I2S using a scope.</div><div id="wwpID0E0UB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>If I2S is configured in TDM mode, please check whether the AMX slot map is configured correctly based on the description in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0EE0HA" title="Tegra ASoC Driver">TDM Slot Mapping</a></span>.</div><div id="wwpID0E0TB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>6.	</span></span>You can also form an internal DAPM path connecting I2S with the same I2S instance using the following command:</div><div id="wwpID0E0SB0HA" class="Code">amixer -c 0 sset ‘I2S Mux’ ‘I2S’</div><div id="wwpID0E0RB0HA" class="List_Continue">If the codec record/playback functions correctly, that confirms I2S and onboard codecs are configured correctly. It also isolates the problem to rest of the AHUB path.</div><div id="wwpID0E0QB0HA" class="Heading_2">Miscellaneous Examples</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0OB0HA">Simple Internal Audio Path</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0MB0HA">Routing Commands</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E6HA">Testing Commands</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E1HA">I2S-x and I2S-y Under Same Clock Domain</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0EYHA">Routing Commands</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0EHHA">Testing Commands</a></div></dd></dl></dl></div><div id="wwpID0E0PB0HA" class="Body_Text">This section describes setting up the XBAR internal audio path from user space for complicated Tegra use cases.</div><div id="wwpID0E0OB0HA" class="Heading_3">Simple Internal Audio Path</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E0MB0HA">Routing Commands</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0E6HA">Testing Commands</a></div></dd></dl></div><div class="ww_skin_page_overflow"><div id="wwpID0E0NB0HA" class="Body_Text" style="margin-left: 0pt; text-indent: -27pt"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.15.jpg" style="display: inline; left: 0pt; top: 0pt" alt=""></div></div><div id="wwpID0E0MB0HA" class="Heading_4">Routing Commands</div><div id="wwpID0E0LB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>AMX connection:</div><div id="wwpID0E0KB0HA" class="Code">amixer -c 0 sset 'AMX2-1 Mux' 'ADMAIF5'</div><div id="wwpID0E0JB0HA" class="Code">amixer -c 0 sset 'AMX2-2 Mux' 'AFC1'</div><div id="wwpID0E0IB0HA" class="Code">amixer -c 0 sset 'AMX2-3 Mux' 'ADMAIF6'</div><div id="wwpID0E0HB0HA" class="Code">amixer -c 0 sset 'AMX2-4 Mux' 'ADX2-1'</div><div id="wwpID0E0GB0HA" class="Code">amixer -c 0 sset 'I2S3 Mux' 'AMX2'</div><div id="wwpID0E0FB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>ADX connection:</div><div id="wwpID0E0EB0HA" class="Code">amixer -c 0 sset ‘ADX2 Mux' 'I2S3'</div><div id="wwpID0E0DB0HA" class="Code">amixer -c 0 sset 'ADMAIF5 Mux' 'ADX2-4'</div><div id="wwpID0E0CB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>AFC connection:</div><div id="wwpID0E0BB0HA" class="Code">amixer -c 0 sset 'AFC1 Mux' 'I2S4'</div><div id="wwpID0E0AB0HA" class="Code">amixer -c 0 sset 'I2S4 Mux' 'ADMAIF7'</div><div id="wwpID0E6HA" class="Heading_4">Testing Commands</div><div id="wwpID0E5HA" class="Code">aplay -c 0 -D hw:0,4 -f S16_LE -r 48000 sample1.wav&amp;</div><div id="wwpID0E4HA" class="Code">aplay -c 0 -D hw:0,5 -f S16_LE -r 48000 sample2.wav&amp;</div><div id="wwpID0E3HA" class="Code">aplay -c 0 -D hw:0,6 -f S16_LE -r 48000 sample3.wav&amp;</div><div id="wwpID0E2HA" class="Code">arecord -c 0 -D hw:0,4 -f wav -c 2 -r 48000 -b 16 sample4.wav &amp;</div><div id="wwpID0E1HA" class="Heading_3">I2S-x and I2S-y Under Same Clock Domain</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0EYHA">Routing Commands</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0EHHA">Testing Commands</a></div></dd></dl></div><div id="wwpID0EZHA" class="Body_Text">If I2S-x and I2S-y are under the same clock domain for the sake of case study, AFC1 insertion between ADX1-1 and AMX1-4 does not help. However, the audio routing path can still be constructed as illustrated below and described in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0EYHA" title="Tegra ASoC Driver">Routing Commands</a></span> and <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_asoc_driver.html#wwpID0EHHA" title="Tegra ASoC Driver">Testing commands</a></span>.</div><div class="ww_skin_page_overflow"><div id="wwpID0EYHA" class="Heading_4"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/l4t_asoc_driver.1.16.jpg" style="display: inline; left: 0pt; top: 0pt" alt="">Routing Commands</div></div><div id="wwpID0EXHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>AMX connection:</div><div id="wwpID0EWHA" class="Code">amixer -c 0 sset 'AMX1-1 Mux' 'ADMAIF1'</div><div id="wwpID0EVHA" class="Code">amixer -c 0 sset 'AMX1-2 Mux' 'AFC1'</div><div id="wwpID0EUHA" class="Code">amixer -c 0 sset 'AMX1-3 Mux' 'ADMAIF2'</div><div id="wwpID0ETHA" class="Code">amixer -c 0 sset 'AMX1-4 Mux' 'AFC2'</div><div id="wwpID0ESHA" class="Code">amixer -c 0 sset 'I2S4 Mux' 'AMX1'</div><div id="wwpID0ERHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>ADX connection:</div><div id="wwpID0EQHA" class="Code">amixer -c 0 sset ‘ADX2 Mux' 'I2S3'</div><div id="wwpID0EPHA" class="Code">amixer -c 0 sset 'ADMAIF2 Mux' 'ADX2-4'</div><div id="wwpID0EOHA" class="Code">amixer -c 0 sset 'AFC1 Mux' 'ADX2-1'</div><div id="wwpID0ENHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>AFC/SFC connection:</div><div id="wwpID0EMHA" class="Code">amixer -c 0 sset 'SFC1 Mux' 'I2S5'</div><div id="wwpID0ELHA" class="Code">amixer -c 0 sset 'I2S5 Mux' 'ADMAIF3'</div><div id="wwpID0EKHA" class="Code">amixer -c 0 sset 'AFC2 Mux' 'SFC1'</div><div id="wwpID0EJHA" class="Code">amixer -c 0 cset iface=MIXER,name='output rate' '48kHz'</div><div id="wwpID0EIHA" class="Code">amixer -c 0 sset 'I2S5 Loopback' 1</div><div id="wwpID0EHHA" class="Heading_4">Testing Commands</div><div id="wwpID0EGHA" class="Code">aplay -c 0 -D hw:0,0 -f S16_LE -r 48000 sample1.wav&amp;</div><div id="wwpID0EFHA" class="Code">aplay -c 0 -D hw:0,1 -f S16_LE -r 48000 sample2.wav&amp;</div><div id="wwpID0EEHA" class="Code">aplay -c 0 -D hw:0,2 -f S16_LE -r 48000 sample3.wav&amp;</div><div id="wwpID0EDHA" class="Code">arecord -c 0 -D hw:0,1 -f wav -c 2 -r 48000 -b 16 sample4.wav &amp;</div><div id="wwpID0EBHA" class="Code">&nbsp;</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br><hr color="#DEE4F0"><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b><br>
        Copyright © 2011-2016 by NVIDIA Corporation.
          All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray">
           PG_06076-R24<br>
        Revised: 11 May 2016
        </font></td></tr></table></footer></body></html>