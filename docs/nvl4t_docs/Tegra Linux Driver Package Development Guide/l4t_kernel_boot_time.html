<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>NVIDIA Tegra Linux Driver Package Development Guide</title><link rel="Prev" href="l4t_uboot_guide.html" title="Previous"><link rel="Next" href="l4t_lauterbach_scripts_r23.html" title="Next"><link rel="StyleSheet" href="css/l4t_kernel_boot_time.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/l4t_kernel_boot_time_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN5TQaN5LgLAhH_002bD3wT9G_002fYA" class="ww_skin_page_body" style="background-attachment: scroll; background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html');"><header><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0"></td><td class="Header_Right">
           Tegra Linux Driver Package<br>
           Development Guide <br><font size="-1">May 16, 2016 | 24.1 Release</font></td></tr></table></div><!--     <br clear="all">
 --><hr color="#DEE4F0"><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E0ZD0HA" class="Heading_1">Kernel Boot Time Optimization</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E0QD0HA">Device Tree Nodes</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E0LB0HA">Environment Configuration</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E5HA">Compile-Time Configuration</a></div></dd></dl></div><div id="wwpID0E0YD0HA" class="Body_Text">NVIDIA<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;Tegra<span style="font-size: smaller; vertical-align: super">®</span>&nbsp;Linux Driver Package (L4T) provides a generic boot kernel for development of your product. To decrease kernel boot time, you can customize the provided kernel based on the requirements of your product.</div><div id="wwpID0E0XD0HA" class="Body_Text">The kernel includes a default configuration that enables all supported hardware features, and searches all available devices for boot scripts. This enables out-of-the box support for the widest possible variety of controllers, features, storage devices, and boot configurations.</div><div id="wwpID0E0WD0HA" class="Body_Text">This flexibility comes at a cost:</div><div id="wwpID0E0VD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Some hardware support takes time to initialize</div><div id="wwpID0E0UD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Enabling all software features, mostly over Advanced Peripheral Bus (APB), takes time</div><div id="wwpID0E0TD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Scanning all attached storage and network devices takes time thereby delaying execution of the final operating system</div><div id="wwpID0E0SD0HA" class="Body_Text">In constrained or pre-configured systems, this flexibility may not be necessary; the system designer may know ahead of time which storage device contains the required files, or know that certain devices do not need to be initialized by the kernel. To reduce system boot time, you can configure the kernel to respect these constraints.</div><div id="wwpID0E0RD0HA" class="Body_Text">For a Jetson Tegra X1 system running L4T R24 with the default configuration, it takes 12 seconds from cold power-on to begin showing the login prompt. When the following optimization techniques are applied, that process can be reduced to approximately three seconds.</div><div id="wwpID0E0QD0HA" class="Heading_2">Device Tree Nodes</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E0OD0HA">PCIe</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E0KC0HA">Pinmux</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E06B0HA">Real-time Clock</a></div></dd></dl></div><div id="wwpID0E0PD0HA" class="Body_Text">If you are not using any controller from Tegra SoC, disable the Device Tree nodes for those device tree entries.</div><div id="wwpID0E0OD0HA" class="Heading_3">PCIe</div><div id="wwpID0E0ND0HA" class="Body_Text">If you are not using PCIe, disable both the ports from the kernel Device Tree Blob (DTB). If you are using one port, disable the second one.</div><div id="wwpID0E0MD0HA" class="Body_Text">The Device Tree Source (DTS) file in the L4T package is available at:</div><div id="wwpID0E0LD0HA" class="Code">arch/arm64/boot/dts/tegra210-jetson-cv-base-p2597-2180-a00.dts</div><div id="wwpID0E0KD0HA" class="Heading_5">To disable PCIe ports</div><div id="wwpID0E0JD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Modify the controller and each PCIe port status as shown in the following example.</div><div id="wwpID0E0ID0HA" class="Code">pcie-controller {</div><div id="wwpID0E0HD0HA" class="Code">                nvidia,wake-gpio = &lt;&amp;gpio TEGRA_GPIO(A, 2) 0&gt;;</div><div id="wwpID0E0GD0HA" class="Code">                nvidia,lane-map = &lt;0x14&gt;;</div><div id="wwpID0E0FD0HA" class="Code">                dvdd-pex-pll-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E0ED0HA" class="Code">                l0-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E0DD0HA" class="Code">                l1-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E0CD0HA" class="Code">                l2-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E0BD0HA" class="Code">                l3-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E0AD0HA" class="Code">                l4-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E06C0HA" class="Code">                l5-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E05C0HA" class="Code">                l6-dvddio-pex-supply = &lt;&amp;max77620_ldo1&gt;;</div><div id="wwpID0E04C0HA" class="Code">                hvdd-pex-pll-e-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E03C0HA" class="Code">                l0-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E02C0HA" class="Code">                l1-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E01C0HA" class="Code">                l2-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E0ZC0HA" class="Code">                l3-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E0YC0HA" class="Code">                l4-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E0XC0HA" class="Code">                l5-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E0WC0HA" class="Code">                l6-hvddio-pex-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E0VC0HA" class="Code">                vddio-pex-ctl-supply = &lt;&amp;max77620_sd3&gt;;</div><div id="wwpID0E0UC0HA" class="Code">                status = "<span style="color: #FF0000">disabled</span>";</div><div id="wwpID0E0TC0HA" class="Code">&nbsp;</div><div id="wwpID0E0SC0HA" class="Code">                pci@1,0 {</div><div id="wwpID0E0RC0HA" class="Code">                        status = "<span style="color: #FF0000">disabled</span>";</div><div id="wwpID0E0QC0HA" class="Code">                };</div><div id="wwpID0E0PC0HA" class="Code">&nbsp;</div><div id="wwpID0E0OC0HA" class="Code">                pci@2,0 {</div><div id="wwpID0E0NC0HA" class="Code">                        status = "<span style="color: #FF0000">disabled</span>";</div><div id="wwpID0E0MC0HA" class="Code">                };</div><div id="wwpID0E0LC0HA" class="Code">        };</div><div id="wwpID0E0KC0HA" class="Heading_3">Pinmux</div><div id="wwpID0E0JC0HA" class="Body_Text">There is duplicity of pinmux and GPIO configuration in u-boot and the kernel; however you can remove this duplicity modifying the configuration. The default configurations are performed based on customer_pinmux.xlsm sheet at one place (u-boot). Extra configuration can be performed by the specific driver. </div><div id="wwpID0E0IC0HA" class="Heading_5">To eliminate pinmux duplicity</div><div id="wwpID0E0HC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Remove the following pinmux-name nodes from the device tree DTS file.</div><div id="wwpID0E0GC0HA" class="Code">/ {</div><div id="wwpID0E0FC0HA" class="Code">        pinmux: pinmux@700008d4 {</div><div id="wwpID0E0EC0HA" class="Code">                status = "okay";</div><div id="wwpID0E0DC0HA" class="Code">                <span style="color: #FF0000">pinctrl-names = "default", "drive", "unused";</span></div><div id="wwpID0E0CC0HA" class="Code">                pinctrl-0 = &lt;&amp;pinmux_default&gt;;</div><div id="wwpID0E0BC0HA" class="Code">                pinctrl-1 = &lt;&amp;drive_default&gt;;</div><div id="wwpID0E0AC0HA" class="Code">                pinctrl-2 = &lt;&amp;pinmux_unused_lowpower&gt;;</div><div id="wwpID0E06B0HA" class="Heading_3">Real-time Clock</div><div id="wwpID0E05B0HA" class="Body_Text">Two Real-time Clocks (RTC) are enabled by default:</div><div id="wwpID0E04B0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Tegra RTC</div><div id="wwpID0E03B0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>PMCI RTC</div><div id="wwpID0E02B0HA" class="Body_Text">Enable one, both, or none, based on your development needs. Be aware of the following differences:</div><div id="wwpID0E01B0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Tegra RTC is the fastest in response, but cannot work as a backup RTC when the system is turned off.</div><div id="wwpID0E0ZB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>PMIC RTC can work as a backup RTC, however it is slow in response because of the transfer average to I2C.</div><div id="wwpID0E0YB0HA" class="Body_Text">If you do not shutdown the system, of if you are not concerned about backup time, then you do not need to enable RTC. Disabling RTC can speed up boot time.</div><div id="wwpID0E0XB0HA" class="Heading_5">To disable the RTC</div><div id="wwpID0E0WB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Remove the the following configuration from your <span class="Code_Char">tegra21_defconfig</span> file.</div><div id="wwpID0E0VB0HA" class="Code">CONFIG_TRC_DRV_MAX77620=y</div><div id="wwpID0E0UB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Add the following configuration to the <span class="Code_Char">tegra21_defconfig</span> file.</div><div id="wwpID0E0TB0HA" class="Code"># CONFIG_RTC_HCTOSYS is not set</div><div id="wwpID0E0SB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Set the Tegra RTC to disabled in the DTS file as follows:</div><div id="wwpID0E0RB0HA" class="Code">rtc {</div><div id="wwpID0E0QB0HA" class="Code">        compatible = "nvidia,tegra-rtc";</div><div id="wwpID0E0PB0HA" class="Code">        reg = &lt;0x00000000 0x00000003 0x00000002 0x0000009b&gt;;</div><div id="wwpID0E0OB0HA" class="Code">        interrupts = &lt;0x00000000 0x00000005 0x00000002&gt;;</div><div id="wwpID0E0NB0HA" class="Code">        status = "disabled";</div><div id="wwpID0E0MB0HA" class="Code">    };</div><div id="wwpID0E0LB0HA" class="Heading_2">Environment Configuration</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E0JB0HA">Single Step Boot</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E0BB0HA">Disable Console over UART</a></div></dd></dl></div><div id="wwpID0E0KB0HA" class="Body_Text">You can optimize boot time by modifying the environment configuration in the root file system.</div><div id="wwpID0E0JB0HA" class="Heading_3">Single Step Boot</div><div id="wwpID0E0IB0HA" class="Body_Text">If you are not using the Network File System (NFS), you can reduce the kernel boot time by approximately 3 seconds by modify the default initial ramdisk (<span class="Code_Char">initrd</span>) to disable it from loading the temporary root file system.</div><div id="wwpID0E0HB0HA" class="Body_Text">By default, <span class="Code_Char">initrd</span> is set for <span class="Code_Char">rootdev_type</span> for network and external boot media. For example, SD card, USB stick. </div><div id="wwpID0E0GB0HA" class="Heading_5">To modify the initrd settings</div><div id="wwpID0E0FB0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Execute the following command to rename the original initrd file.</div><div id="wwpID0E0EB0HA" class="Code">mv l4t_initrd.img l4t_initrd.img_orig</div><div id="wwpID0E0DB0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Execute the following command:</div><div id="wwpID0E0CB0HA" class="Code">touch l4t_initrd.img</div><div id="wwpID0E0BB0HA" class="Heading_3">Disable Console over UART</div><div id="wwpID0E0AB0HA" class="Body_Text">Prints over UART are a major bottleneck in kernel boot time. To reduce this time, you can remove <span class="Code_Char">console=ttyS0</span> from the <span class="Code_Char">extlinux.conf</span> configuration file. </div><div id="wwpID0E6HA" class="Body_Text">Once the system is ready for deployment, you can remove the UART console logs or review the console logs over the Framebuffer console. The console log is <span class="Code_Char">console=tty1</span> in the <span class="Code_Char">extlinux.conf</span> configuration file.</div><div id="wwpID0E5HA" class="Heading_2">Compile-Time Configuration</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0E1HA">Asynchronous Probe</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0EKHA">File System</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_kernel_boot_time.html#wwpID0EFHA">Sound</a></div></dd></dl></div><div id="wwpID0E4HA" class="Body_Text">To reduce compile-time configuration, examine the generated configuration file to identify which configurations are required. Once the required configurations are defined, identify which ones to boot asynchronously. For those configurations, the drivers probe is executed asynchronously in a separate thread instead of the main initial thread.</div><div id="wwpID0E3HA" class="Body_Text">Additionally, examine the required configurations and verify that they can be programmed as modules so that the drivers are loaded when it is called for use. When the drivers are not loaded, the kernel image is reduced and more RAM space is available. </div><div id="wwpID0E2HA" class="Body_Text">The following topics provide examples of each of these conditions.</div><div id="wwpID0E1HA" class="Heading_3">Asynchronous Probe</div><div id="wwpID0EZHA" class="Body_Text">The asynchronous probe feature is available, by default, in Kernel Version 3.18. For Kernel Version 3.10, you must cherry-pick the patches from the mainline available at:</div><div id="wwpID0EYHA" class="Code"><span class="Hyperlink"><a href="https://lkml.org/lkml/2015/1/16/576" target="external_window">https://lkml.org/lkml/2015/1/16/576</a></span></div><div id="wwpID0EXHA" class="Heading_5">To move the driver to another thread</div><div id="wwpID0EWHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•</span></span>Add the <span class="Code_Char">probe_type</span> in your driver as follows:</div><div id="wwpID0EVHA" class="Code">static struct platform_driver sdhci_tegra_driver = {</div><div id="wwpID0EUHA" class="Code">        .driver         = {</div><div id="wwpID0ETHA" class="Code">                .name   = "sdhci-tegra",</div><div id="wwpID0ESHA" class="Code">                .of_match_table = sdhci_tegra_dt_match,</div><div id="wwpID0ERHA" class="Code">                .pm     = SDHCI_PLTFM_PMOPS,</div><div id="wwpID0EQHA" class="Code">                .probe_type = PROBE_PREFER_ASYNCHRONOUS,</div><div id="wwpID0EPHA" class="Code">        },</div><div id="wwpID0EOHA" class="Code">        .probe          = sdhci_tegra_probe,</div><div id="wwpID0ENHA" class="Code">        .remove         = sdhci_tegra_remove,</div><div id="wwpID0EMHA" class="Code">        .shutdown       = sdhci_tegra_shutdown,</div><div id="wwpID0ELHA" class="Code">};</div><div id="wwpID0EKHA" class="Heading_3">File System</div><div id="wwpID0EJHA" class="Body_Text">To decrease boot time the filesystem, modify the following configurations to set them as modules:</div><div id="wwpID0EIHA" class="Code">CONFIG_FUSE_FS=m</div><div id="wwpID0EHHA" class="Code">CONFIG_VFAT_FS=m</div><div id="wwpID0EGHA" class="Code">CONFIG_NTFS_FS=m</div><div id="wwpID0EFHA" class="Heading_3">Sound</div><div id="wwpID0EEHA" class="Body_Text">Audio codec requires some time to initialize, To eliminate this initialization time, disable the audio configurations as follows:</div><div id="wwpID0EDHA" class="Code"># CONFIG_SND_SOC_TEGRA_ALT is not set</div><div id="wwpID0ECHA" class="Code"># CONFIG_SND_SOC_TEGRA_T210REF_MOBILE_ALT is not set</div><div id="wwpID0EBHA" class="Code"># CONFIG_SND_SOC_TEGRA_T210REF_MOBILE_ES755_ALT is not set</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br><hr color="#DEE4F0"><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b><br>
        Copyright © 2011-2016 by NVIDIA Corporation.
          All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray">
           PG_06076-R24<br>
        Revised: 11 May 2016
        </font></td></tr></table></footer></body></html>